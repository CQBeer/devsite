<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>合约交易离线组装 | NULS</title>
    <meta name="description" content="让区块链更简单">
    <link rel="icon" href="/icon.png">
    
    <link rel="preload" href="/assets/css/0.styles.a1300348.css" as="style"><link rel="preload" href="/assets/js/app.ff9a8a4d.js" as="script"><link rel="preload" href="/assets/js/60.071e1c19.js" as="script"><link rel="prefetch" href="/assets/js/10.908a54c6.js"><link rel="prefetch" href="/assets/js/11.bd34c7d0.js"><link rel="prefetch" href="/assets/js/12.7358d934.js"><link rel="prefetch" href="/assets/js/13.5026de6e.js"><link rel="prefetch" href="/assets/js/14.f289b167.js"><link rel="prefetch" href="/assets/js/15.05b7e739.js"><link rel="prefetch" href="/assets/js/16.52f3bc5b.js"><link rel="prefetch" href="/assets/js/17.c824039f.js"><link rel="prefetch" href="/assets/js/18.840f0d14.js"><link rel="prefetch" href="/assets/js/19.4259104e.js"><link rel="prefetch" href="/assets/js/2.aef32cc5.js"><link rel="prefetch" href="/assets/js/20.ea39dca9.js"><link rel="prefetch" href="/assets/js/21.60438a15.js"><link rel="prefetch" href="/assets/js/22.2df5d9a8.js"><link rel="prefetch" href="/assets/js/23.89e04919.js"><link rel="prefetch" href="/assets/js/24.fba1f5f1.js"><link rel="prefetch" href="/assets/js/25.ea30f1c1.js"><link rel="prefetch" href="/assets/js/26.e8313c3f.js"><link rel="prefetch" href="/assets/js/27.738174e6.js"><link rel="prefetch" href="/assets/js/28.618f6f9e.js"><link rel="prefetch" href="/assets/js/29.bf3f3d03.js"><link rel="prefetch" href="/assets/js/3.90ed52c4.js"><link rel="prefetch" href="/assets/js/30.7ee5ad23.js"><link rel="prefetch" href="/assets/js/31.aa2cb318.js"><link rel="prefetch" href="/assets/js/32.3bce5208.js"><link rel="prefetch" href="/assets/js/33.655692f4.js"><link rel="prefetch" href="/assets/js/34.e201f85a.js"><link rel="prefetch" href="/assets/js/35.49c826cd.js"><link rel="prefetch" href="/assets/js/36.aff2112c.js"><link rel="prefetch" href="/assets/js/37.a567dafb.js"><link rel="prefetch" href="/assets/js/38.e86114b0.js"><link rel="prefetch" href="/assets/js/39.9dcd0d14.js"><link rel="prefetch" href="/assets/js/4.b35bce24.js"><link rel="prefetch" href="/assets/js/40.13015d8a.js"><link rel="prefetch" href="/assets/js/41.c926201b.js"><link rel="prefetch" href="/assets/js/42.ecb5fdc6.js"><link rel="prefetch" href="/assets/js/43.7e354ec4.js"><link rel="prefetch" href="/assets/js/44.f0d1ac2d.js"><link rel="prefetch" href="/assets/js/45.c632aa6a.js"><link rel="prefetch" href="/assets/js/46.0d463c3f.js"><link rel="prefetch" href="/assets/js/47.6ddd38f2.js"><link rel="prefetch" href="/assets/js/48.357d6f47.js"><link rel="prefetch" href="/assets/js/49.fac67488.js"><link rel="prefetch" href="/assets/js/5.f56fea99.js"><link rel="prefetch" href="/assets/js/50.ca18e13b.js"><link rel="prefetch" href="/assets/js/51.af09458b.js"><link rel="prefetch" href="/assets/js/52.bdad80b6.js"><link rel="prefetch" href="/assets/js/53.4ea93e0d.js"><link rel="prefetch" href="/assets/js/54.991c7cc2.js"><link rel="prefetch" href="/assets/js/55.1652a0e9.js"><link rel="prefetch" href="/assets/js/56.f8b88d2c.js"><link rel="prefetch" href="/assets/js/57.62e70612.js"><link rel="prefetch" href="/assets/js/58.ee2b8a2d.js"><link rel="prefetch" href="/assets/js/59.3a65d3ab.js"><link rel="prefetch" href="/assets/js/6.0641bc7b.js"><link rel="prefetch" href="/assets/js/61.ae93856d.js"><link rel="prefetch" href="/assets/js/62.4c39b766.js"><link rel="prefetch" href="/assets/js/63.08582e36.js"><link rel="prefetch" href="/assets/js/64.b43e00d2.js"><link rel="prefetch" href="/assets/js/65.742f43b6.js"><link rel="prefetch" href="/assets/js/66.ba7db902.js"><link rel="prefetch" href="/assets/js/67.6b40c8a4.js"><link rel="prefetch" href="/assets/js/68.6f7619d2.js"><link rel="prefetch" href="/assets/js/69.143d9fd0.js"><link rel="prefetch" href="/assets/js/7.4661d4f9.js"><link rel="prefetch" href="/assets/js/8.b652d739.js"><link rel="prefetch" href="/assets/js/9.fb483f76.js">
    <link rel="stylesheet" href="/assets/css/0.styles.a1300348.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">NULS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/Guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/Docs/" class="nav-link router-link-active">开发</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/s_offline_assembly.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/tree/dev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/Guide/" class="nav-link">指南</a></div><div class="nav-item"><a href="/zh/Docs/" class="nav-link router-link-active">开发</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh/Docs/s_offline_assembly.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite/tree/dev" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading"><span>设计文档</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/zh/Docs/d_network.html" class="sidebar-link">网络模块设计文档</a></li><li><a href="/zh/Docs/d_ledger.html" class="sidebar-link">账本模块设计文档</a></li><li><a href="/zh/Docs/d_chain_manager.html" class="sidebar-link">链管理模块设计文档</a></li><li><a href="/zh/Docs/d_account.html" class="sidebar-link">账户模块设计文档</a></li><li><a href="/zh/Docs/d_transaction.html" class="sidebar-link">交易管理模块设计文档</a></li><li><a href="/zh/Docs/d_cross_chain.html" class="sidebar-link">跨链模块设计文档</a></li><li><a href="/zh/Docs/d_consensus.html" class="sidebar-link">共识模块设计文档</a></li><li><a href="/zh/Docs/d_public_service.html" class="sidebar-link">public-service模块设计文档</a></li><li><a href="/zh/Docs/d_block.html" class="sidebar-link">区块管理模块设计文档</a></li><li><a href="/zh/Docs/d_protocol_update.html" class="sidebar-link">协议升级模块设计文档</a></li><li><a href="/zh/Docs/d_address.html" class="sidebar-link">NULS Protocol Address</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>接口文档</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/zh/Docs/i_rpc_protocol.html" class="sidebar-link">接口交互格式与规范 JSON-RPC</a></li><li><a href="/zh/Docs/i_public_service.html" class="sidebar-link">NULS2.0——API接口文档</a></li><li><a href="/zh/Docs/i_nuls-api_JSONRPC.html" class="sidebar-link">NULS2.0 API-JSONRPC</a></li><li><a href="/zh/Docs/i_nuls-api_RESTFUL.html" class="sidebar-link">NULS2.0 API-RESTFUL</a></li><li><a href="/zh/Docs/i_account.html" class="sidebar-link">账户模块</a></li><li><a href="/zh/Docs/i_chain-manager.html" class="sidebar-link">链管理模块</a></li><li><a href="/zh/Docs/i_cross-chain.html" class="sidebar-link">跨链模块</a></li><li><a href="/zh/Docs/i_network.html" class="sidebar-link">网络模块</a></li><li><a href="/zh/Docs/i_block.html" class="sidebar-link">区块模块</a></li><li><a href="/zh/Docs/i_transaction.html" class="sidebar-link">交易模块</a></li><li><a href="/zh/Docs/i_consensus.html" class="sidebar-link">POC共识模块</a></li><li><a href="/zh/Docs/i_smart-contract.html" class="sidebar-link">智能合约模块</a></li><li><a href="/zh/Docs/i_ledger.html" class="sidebar-link">账本模块</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>ChainBox</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/zh/Docs/c_chain_box.html" class="sidebar-link">NULS ChainBox</a></li><li><a href="/zh/Docs/c_module.html" class="sidebar-link">开发业务模块</a></li><li><a href="/zh/Docs/c_message_module.html" class="sidebar-link">加密信息模块示例</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading open"><span>智能合约</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/zh/Docs/s_manual.html" class="sidebar-link">开发手册</a></li><li><a href="/zh/Docs/s_tools.html" class="sidebar-link">开发工具</a></li><li><a href="/zh/Docs/s_nrc20.html" class="sidebar-link">NRC-20</a></li><li><a href="/zh/Docs/s_nrc721.html" class="sidebar-link">NRC-721非同质资产标准</a></li><li><a href="/zh/Docs/s_offline_assembly.html" class="active sidebar-link">合约交易离线组装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_1-java" class="sidebar-link">1. Java</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_1-1-发布合约的交易" class="sidebar-link">1.1 发布合约的交易</a></li><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_1-2-调用合约的交易" class="sidebar-link">1.2 调用合约的交易</a></li><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_1-3-删除合约的交易" class="sidebar-link">1.3 删除合约的交易</a></li></ul></li><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_2-javascript" class="sidebar-link">2. JavaScript</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_2-1-创建合约" class="sidebar-link">2.1 创建合约</a></li><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_2-2-调用合约" class="sidebar-link">2.2 调用合约</a></li><li class="sidebar-sub-header"><a href="/zh/Docs/s_offline_assembly.html#_2-3-删除合约" class="sidebar-link">2.3 删除合约</a></li></ul></li></ul></li><li><a href="/zh/Docs/s_advance.html" class="sidebar-link">高级说明</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="合约交易离线组装"><a href="#合约交易离线组装" aria-hidden="true" class="header-anchor">#</a> 合约交易离线组装</h1> <p><strong>智能合约有三种要组装的交易，分别是<code>发布合约</code>、<code>调用合约</code>、<code>删除合约</code>，下面将使用<code>Java</code>语言和<code>JavaScript</code>语言分别介绍这三种交易的离线组装方式</strong></p> <blockquote><p>文档中使用 <strong><code>NRC20合约代码</code></strong> 作为示例</p></blockquote> <h2 id="_1-java"><a href="#_1-java" aria-hidden="true" class="header-anchor">#</a> 1. Java</h2> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 主链的ID，示例中使用2</span>
<span class="token keyword">int</span> chainId <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token comment">// 主链的资产ID，示例中使用1</span>
<span class="token keyword">int</span> assetsId <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="_1-1-发布合约的交易"><a href="#_1-1-发布合约的交易" aria-hidden="true" class="header-anchor">#</a> 1.1 发布合约的交易</h3> <p>组装发布合约的交易需要与apiModule交互四次</p> <ul><li>获取构造函数</li> <li>验证发布合约的执行合法性</li> <li>预估发布合约需要的GAS</li> <li>获取交易创建者的余额和nonce</li></ul> <p><strong>最初数据: <code>交易创建者地址</code>, <code>合约代码字节码的Hex字符串</code>, <code>合约别名</code>, <code>交易备注</code></strong></p> <h4 id="_1-1-1-调用接口获取合约代码构造函数"><a href="#_1-1-1-调用接口获取合约代码构造函数" aria-hidden="true" class="header-anchor">#</a> 1.1.1) 调用接口获取合约代码构造函数</h4> <ul><li><p>接口: getContractConstructor</p></li> <li><p>参数: chainId, contractCode</p> <p>chainId : int //链ID</p> <p>contractCode: String // 文件字节流转换Hex编码字符串</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getContractConstructor&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;constructor&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
               <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&lt;init&gt;&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;desc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;(String name, String symbol, BigInteger initialAmount, int decimals) return void&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;args&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;String&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;BigInteger&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;initialAmount&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span><span class="token punctuation">,</span>
                    <span class="token punctuation">{</span>
                         <span class="token property">&quot;type&quot;</span><span class="token operator">:</span> <span class="token string">&quot;int&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;name&quot;</span><span class="token operator">:</span> <span class="token string">&quot;decimals&quot;</span><span class="token punctuation">,</span>
                         <span class="token property">&quot;required&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
                    <span class="token punctuation">}</span>
               <span class="token punctuation">]</span><span class="token punctuation">,</span>
               <span class="token property">&quot;returnArg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;void&quot;</span><span class="token punctuation">,</span>
               <span class="token property">&quot;view&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token property">&quot;event&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               <span class="token property">&quot;payable&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token property">&quot;isNrc20&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-1-2-根据构造函数参数组装参数数据-若是无参函数，则跳过此步"><a href="#_1-1-2-根据构造函数参数组装参数数据-若是无参函数，则跳过此步" aria-hidden="true" class="header-anchor">#</a> 1.1.2) 根据构造函数参数组装参数数据**(若是无参函数，则跳过此步)**</h4> <ul><li><p>把构造函数的参数类型组装成一个字符串数组</p> <blockquote><p>从<code>getContractConstructor</code>接口中得到此类数据</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>Map constructor <span class="token operator">=</span> <span class="token punctuation">(</span>Map<span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;constructor&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
List<span class="token generics function"><span class="token punctuation">&lt;</span>Map<span class="token punctuation">&gt;</span></span> args <span class="token operator">=</span> <span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>Map<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> constructor<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;args&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String<span class="token punctuation">[</span><span class="token punctuation">]</span> argTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>Map arg <span class="token operator">:</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    argTypes<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> arg<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;type&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 此例中 argTypes 包含四个元素 {&quot;String&quot;, &quot;String&quot;, &quot;BigInteger&quot;, &quot;int&quot;}</span>
</code></pre></div></li> <li><p>使用一维Object数组，按顺序，把参数添加到数组中</p> <div class="language-java extra-class"><pre class="language-java"><code>Object args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;nulsIsEverything&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;NULS&quot;</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>把参数一维数组转换为二维数组(由于链上合约方法参数接受的是二维数组，故有此步)</p> <blockquote><p>复制这个方法<code>io.nuls.contract.util.ContractUtil#twoDimensionalArray(Object[], String[])</code>到离线交易组装工具程序(eg. SDK)中</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finalArgs <span class="token operator">=</span> ContractUtil<span class="token punctuation">.</span><span class="token function">twoDimensionalArray</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="_1-1-3-调用接口验证发布合约的合法性"><a href="#_1-1-3-调用接口验证发布合约的合法性" aria-hidden="true" class="header-anchor">#</a> 1.1.3) 调用接口验证发布合约的合法性</h4> <ul><li><p>接口: validateContractCreate</p></li> <li><p>参数: chainId, sender, gasLimit, price, contractCode, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>gasLimit: long // gas限制</p> <p>price: long // gas单价</p> <p>contractCode: String // 文件字节流转换Hex编码字符串</p> <p>args: Object[] // 构造方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <blockquote><p>gasLimit和price使用默认值: gasLimit = 10000000; price = 25;</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractCreate&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code>是<code>true</code>时，表示验证通过，否则，<code>success</code>是<code>false</code>, <code>msg</code>是错误信息</p></blockquote> <h4 id="_1-1-4-调用接口预估发布合约需要的gas"><a href="#_1-1-4-调用接口预估发布合约需要的gas" aria-hidden="true" class="header-anchor">#</a> 1.1.4) 调用接口预估发布合约需要的GAS</h4> <ul><li><p>接口: imputedContractCreateGas</p></li> <li><p>参数: chainId, sender, contractCode, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>contractCode: String // 文件字节流转换Hex编码字符串</p> <p>args: Object[] // 构造方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;imputedContractCreateGas&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;504b03040...00000000&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;symbol&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;gasLimit&quot;</span><span class="token operator">:</span> <span class="token number">22363</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code>Long gasLimit <span class="token operator">=</span> <span class="token punctuation">(</span>Long<span class="token punctuation">)</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;gasLimit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-1-5-随机生成一个智能合约地址"><a href="#_1-1-5-随机生成一个智能合约地址" aria-hidden="true" class="header-anchor">#</a> 1.1.5) 随机生成一个智能合约地址</h4> <div class="language-java extra-class"><pre class="language-java"><code>Address contract <span class="token operator">=</span> AccountTool<span class="token punctuation">.</span><span class="token function">createContractAddress</span><span class="token punctuation">(</span>chainId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> contractAddressBytes <span class="token operator">=</span> contract<span class="token punctuation">.</span><span class="token function">getAddressBytes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// String contractAddress = contract.toString();</span>
</code></pre></div><h4 id="_1-1-6-通过以上5步获取的数据，组装交易的txdata"><a href="#_1-1-6-通过以上5步获取的数据，组装交易的txdata" aria-hidden="true" class="header-anchor">#</a> 1.1.6) 通过以上5步获取的数据，组装交易的txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 交易创建者的地址</span>
String sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> AddressTool<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gasLimit 从第4步接口中得到</span>
<span class="token keyword">long</span> gasLimit <span class="token operator">=</span> <span class="token number">22363</span><span class="token punctuation">;</span>
<span class="token comment">// 默认GAS单价, 系统最小单价</span>
<span class="token keyword">long</span> defaultPrice <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
CreateContractData createContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setAlias</span><span class="token punctuation">(</span>alias<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>defaultPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
createContractData<span class="token punctuation">.</span><span class="token function">setCode</span><span class="token punctuation">(</span>contractCode<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>finalArgs <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    createContractData<span class="token punctuation">.</span><span class="token function">setArgsCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> finalArgs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    createContractData<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-1-7-调用接口获取交易创建者的nonce值"><a href="#_1-1-7-调用接口获取交易创建者的nonce值" aria-hidden="true" class="header-anchor">#</a> 1.1.7) 调用接口获取交易创建者的nonce值</h4> <ul><li><p>接口: getAccountBalance</p></li> <li><p>参数: chainId, assetChainId, assetId, address</p> <p>chainId: int //链id</p> <p>assetChainId: int //资产对应的链id</p> <p>assetId  : int //资产id</p> <p>address : String //账户地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code>BigInteger senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-1-8-通过以上7步获取的数据，组装发布合约的交易对象"><a href="#_1-1-8-通过以上7步获取的数据，组装发布合约的交易对象" aria-hidden="true" class="header-anchor">#</a> 1.1.8) 通过以上7步获取的数据，组装发布合约的交易对象</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> CreateContractTransaction <span class="token function">newCreateTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> BigInteger senderBalance<span class="token punctuation">,</span> String nonce<span class="token punctuation">,</span> CreateContractData createContractData<span class="token punctuation">,</span> String remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        CreateContractTransaction tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CreateContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算CoinData</span>
        CoinData coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> createContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>createContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>createContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">private</span> CoinData <span class="token function">makeCoinData</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> BigInteger senderBalance<span class="token punctuation">,</span> String nonce<span class="token punctuation">,</span> ContractData contractData<span class="token punctuation">,</span> <span class="token keyword">int</span> txSize<span class="token punctuation">,</span> <span class="token keyword">int</span> txDataSize<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    CoinData coinData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">long</span> gasUsed <span class="token operator">=</span> contractData<span class="token punctuation">.</span><span class="token function">getGasLimit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BigInteger imputedValue <span class="token operator">=</span> BigInteger<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span>LongUtils<span class="token punctuation">.</span><span class="token function">mul</span><span class="token punctuation">(</span>gasUsed<span class="token punctuation">,</span> contractData<span class="token punctuation">.</span><span class="token function">getPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 总花费</span>
    BigInteger value <span class="token operator">=</span> contractData<span class="token punctuation">.</span><span class="token function">getValue</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    BigInteger totalValue <span class="token operator">=</span> imputedValue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    CoinFrom coinFrom <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinFrom</span><span class="token punctuation">(</span>contractData<span class="token punctuation">.</span><span class="token function">getSender</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> totalValue<span class="token punctuation">,</span> RPCUtil<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>nonce<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    coinData<span class="token punctuation">.</span><span class="token function">addFrom</span><span class="token punctuation">(</span>coinFrom<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>value<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>BigInteger<span class="token punctuation">.</span>ZERO<span class="token punctuation">)</span> <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        CoinTo coinTo <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoinTo</span><span class="token punctuation">(</span>contractData<span class="token punctuation">.</span><span class="token function">getContractAddress</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
        coinData<span class="token punctuation">.</span><span class="token function">addTo</span><span class="token punctuation">(</span>coinTo<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    BigInteger fee <span class="token operator">=</span> TransactionFeeCalculator<span class="token punctuation">.</span><span class="token function">getNormalUnsignedTxFee</span><span class="token punctuation">(</span>txSize <span class="token operator">+</span> txDataSize <span class="token operator">+</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    totalValue <span class="token operator">=</span> totalValue<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>fee<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>senderBalance<span class="token punctuation">.</span><span class="token function">compareTo</span><span class="token punctuation">(</span>totalValue<span class="token punctuation">)</span> <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Insufficient balance</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span><span class="token string">&quot;Insufficient balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    coinFrom<span class="token punctuation">.</span><span class="token function">setAmount</span><span class="token punctuation">(</span>totalValue<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> coinData<span class="token punctuation">;</span>
<span class="token punctuation">}</span>


<span class="token keyword">private</span> <span class="token keyword">int</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>NulsData nulsData<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>nulsData <span class="token operator">==</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">int</span> size <span class="token operator">=</span> nulsData<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">// 计算tx.size()时，当coinData和txData为空时，计算了1个长度，若此时nulsData不为空，则要扣减这1个长度</span>
    <span class="token keyword">return</span> VarInt<span class="token punctuation">.</span><span class="token function">sizeOf</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span> <span class="token operator">+</span> size <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-1-9-签名交易、广播交易（略）"><a href="#_1-1-9-签名交易、广播交易（略）" aria-hidden="true" class="header-anchor">#</a> 1.1.9) 签名交易、广播交易（略）</h4> <hr> <h3 id="_1-2-调用合约的交易"><a href="#_1-2-调用合约的交易" aria-hidden="true" class="header-anchor">#</a> 1.2 调用合约的交易</h3> <p>组装调用合约的交易需要与apiModule交互三<code>or</code>四次</p> <ul><li>获取合约方法的详细信息(若缓存了合约所有方法的详情，则跳过此步)</li> <li>验证调用合约的执行合法性</li> <li>预估调用合约需要的GAS</li> <li>获取交易创建者的余额和nonce</li></ul> <p><strong>最初数据: <code>交易创建者地址</code>,<code>合约地址</code>,<code>调用者向合约地址转入的主网资产金额</code>,<code>调用方法名</code>,<code>调用方法的描述</code>, <code>调用方法的参数</code>, <code>交易备注</code></strong></p> <h4 id="_1-2-1-调用接口获取合约方法的参数类型列表-若缓存了合约所有方法的详情，可从缓存的方法中提取方法的参数类型列表，则跳过此步"><a href="#_1-2-1-调用接口获取合约方法的参数类型列表-若缓存了合约所有方法的详情，可从缓存的方法中提取方法的参数类型列表，则跳过此步" aria-hidden="true" class="header-anchor">#</a> 1.2.1) 调用接口获取合约方法的参数类型列表**(若缓存了合约所有方法的详情，可从缓存的方法中提取方法的参数类型列表，则跳过此步)**</h4> <blockquote><p>这一步的作用是得到方法的参数类型数组，具体筛选的数据请查看<code>1.2.2</code></p></blockquote> <ul><li><p>接口: getContractMethodArgsTypes</p></li> <li><p>参数: chainId, contractAddress, methodName, methodDesc</p> <p>chainId : int //链ID</p> <p>contractAddress: String //合约地址</p> <p>methodName: String // 合约方法</p> <p>methodDesc: String // 合约方法描述  (非必填)，若合约内方法没有重载，则此参数可以为空</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getContractMethodArgsTypes&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;transfer&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;(Address to, BigInteger value) return boolean&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">&quot;Address&quot;</span><span class="token punctuation">,</span>
          <span class="token string">&quot;BigInteger&quot;</span>
     <span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h4 id="_1-2-2-根据函数参数组装参数数据-若是无参函数，则跳过此步"><a href="#_1-2-2-根据函数参数组装参数数据-若是无参函数，则跳过此步" aria-hidden="true" class="header-anchor">#</a> 1.2.2) 根据函数参数组装参数数据**(若是无参函数，则跳过此步)**</h4> <ul><li><p>把函数的参数类型组装成一个字符串数组</p> <blockquote><p>从<code>1.2.1</code>接口中得到此类数据 或者 从缓存的方法详情中获取</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span> list <span class="token operator">=</span> <span class="token punctuation">(</span>List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">&gt;</span></span><span class="token punctuation">)</span> result<span class="token punctuation">;</span>
<span class="token keyword">int</span> size <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String<span class="token punctuation">[</span><span class="token punctuation">]</span> argTypes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">String</span><span class="token punctuation">[</span>size<span class="token punctuation">]</span><span class="token punctuation">;</span>
argTypes <span class="token operator">=</span> list<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// 此例中 argTypes 包含两个元素 {&quot;Address&quot;, &quot;BigInteger&quot;}</span>
</code></pre></div></li> <li><p>使用一维Object数组，按顺序，把参数添加到数组中</p> <div class="language-java extra-class"><pre class="language-java"><code>Object args <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">{</span><span class="token string">&quot;tNULSeBaMnrs6JKrCy6TQdzYJZkMZJDng7QAsD&quot;</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div></li> <li><p>把参数一维数组转换为二维数组(由于链上合约方法参数接受的是二维数组，故有此步)</p> <blockquote><p>复制这个方法<code>io.nuls.contract.util.ContractUtil#twoDimensionalArray(Object[], String[])</code>到离线交易组装工具程序(eg. SDK)中</p></blockquote> <div class="language-java extra-class"><pre class="language-java"><code>String<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> finalArgs <span class="token operator">=</span> ContractUtil<span class="token punctuation">.</span><span class="token function">twoDimensionalArray</span><span class="token punctuation">(</span>args<span class="token punctuation">,</span> argTypes<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></li></ul> <h4 id="_1-2-3-调用接口验证调用合约的合法性"><a href="#_1-2-3-调用接口验证调用合约的合法性" aria-hidden="true" class="header-anchor">#</a> 1.2.3) 调用接口验证调用合约的合法性</h4> <ul><li><p>接口: validateContractCall</p></li> <li><p>参数: chainId, sender, value, gasLimit, price, contractAddress, methodName, methodDesc, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>value: BigInteger // 调用者向合约地址转入的主网资产金额，没有此业务时填BigInteger.ZERO</p> <p>gasLimit: long // gas限制</p> <p>price: long // gas单价</p> <p>contractAddress: String // 合约地址</p> <p>methodName: String // 合约方法</p> <p>methodDesc: String // 合约方法描述，若合约内方法没有重载，则此参数可以为空</p> <p>args: Object[] // 构造方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <blockquote><p>gasLimit和price使用默认值: gasLimit = 10000000; price = 25;</p></blockquote> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractCall&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">10000000</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code>是<code>true</code>时，表示验证通过，否则，<code>success</code>是<code>false</code>, <code>msg</code>是错误信息</p></blockquote> <h4 id="_1-2-4-调用接口预估调用合约需要的gas"><a href="#_1-2-4-调用接口预估调用合约需要的gas" aria-hidden="true" class="header-anchor">#</a> 1.2.4) 调用接口预估调用合约需要的GAS</h4> <ul><li><p>接口: imputedContractCallGas</p></li> <li><p>参数: chainId, sender, value, contractAddress, methodName, methodDesc, args</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>value: BigInteger // 调用者向合约地址转入的主网资产金额，没有此业务时填BigInteger.ZERO</p> <p>contractAddress: String // 合约地址</p> <p>methodName: String // 合约方法</p> <p>methodDesc: String // 合约方法描述，若合约内方法没有重载，则此参数可以为空</p> <p>args: Object[] // 方法参数</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;imputedContractCallGas&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span><span class="token number">100000000</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>

</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;gasLimit&quot;</span><span class="token operator">:</span> <span class="token number">10333</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-2-5-通过以上4步获取的数据，组装交易的txdata"><a href="#_1-2-5-通过以上4步获取的数据，组装交易的txdata" aria-hidden="true" class="header-anchor">#</a> 1.2.5) 通过以上4步获取的数据，组装交易的txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 交易创建者的地址</span>
String sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> AddressTool<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// gasLimit 从第4步接口中得到</span>
<span class="token keyword">long</span> gasLimit <span class="token operator">=</span> <span class="token number">10333</span><span class="token punctuation">;</span>
<span class="token comment">// 默认GAS单价, 系统最小单价</span>
<span class="token keyword">long</span> defaultPrice <span class="token operator">=</span> <span class="token number">25</span><span class="token punctuation">;</span>
<span class="token comment">// value - 交易创建者转入合约地址的主链资产金额，没有此业务时填BigInteger.ZERO</span>
<span class="token comment">// methodName - 交易创建者选择要调用的合约方法</span>
<span class="token comment">// methodDesc - 通过contractInfo获取，若合约内方法没有重载，则此参数可以为空</span>
CallContractData callContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setValue</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setPrice</span><span class="token punctuation">(</span>defaultPrice<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setGasLimit</span><span class="token punctuation">(</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setMethodName</span><span class="token punctuation">(</span>methodName<span class="token punctuation">)</span><span class="token punctuation">;</span>
callContractData<span class="token punctuation">.</span><span class="token function">setMethodDesc</span><span class="token punctuation">(</span>methodDesc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>finalArgs <span class="token operator">!=</span> null<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    callContractData<span class="token punctuation">.</span><span class="token function">setArgsCount</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token keyword">byte</span><span class="token punctuation">)</span> finalArgs<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    callContractData<span class="token punctuation">.</span><span class="token function">setArgs</span><span class="token punctuation">(</span>finalArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-2-6-调用接口获取交易创建者的nonce值"><a href="#_1-2-6-调用接口获取交易创建者的nonce值" aria-hidden="true" class="header-anchor">#</a> 1.2.6) 调用接口获取交易创建者的nonce值</h4> <ul><li><p>接口: getAccountBalance</p></li> <li><p>参数: chainId, assetChainId, assetId, address</p> <p>chainId: int //链id</p> <p>assetChainId: int //资产对应的链id</p> <p>assetId  : int //资产id</p> <p>address : String //账户地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code>BigInteger senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-2-7-通过以上6步获取的数据，组装发布合约的交易对象"><a href="#_1-2-7-通过以上6步获取的数据，组装发布合约的交易对象" aria-hidden="true" class="header-anchor">#</a> 1.2.7) 通过以上6步获取的数据，组装发布合约的交易对象</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> CallContractTransaction <span class="token function">newCallTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> BigInteger senderBalance<span class="token punctuation">,</span> String nonce<span class="token punctuation">,</span> CallContractData callContractData<span class="token punctuation">,</span> String remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        CallContractTransaction tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CallContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算CoinData</span>
        CoinData coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> callContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>callContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>callContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-2-8-签名交易、广播交易（略）"><a href="#_1-2-8-签名交易、广播交易（略）" aria-hidden="true" class="header-anchor">#</a> 1.2.8) 签名交易、广播交易（略）</h4> <hr> <h3 id="_1-3-删除合约的交易"><a href="#_1-3-删除合约的交易" aria-hidden="true" class="header-anchor">#</a> 1.3 删除合约的交易</h3> <p>组装删除合约的交易需要与apiModule交互两次</p> <ul><li>验证调用合约的执行合法性</li> <li>获取交易创建者的余额和nonce</li></ul> <p><strong>最初数据: <code>交易创建者地址</code>,<code>合约地址</code></strong></p> <h4 id="_1-3-1-调用接口验证删除合约的合法性"><a href="#_1-3-1-调用接口验证删除合约的合法性" aria-hidden="true" class="header-anchor">#</a> 1.3.1) 调用接口验证删除合约的合法性</h4> <ul><li><p>接口: validateContractDelete</p></li> <li><p>参数: chainId, sender, contractAddress</p> <p>chainId : int //链ID</p> <p>sender: String // 调用者地址</p> <p>contractAddress: String // 合约地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;validateContractDelete&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;tNULSeBaMwQPRn1yQEyd74CuD9uJqYVipgRtwi&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;msg&quot;</span><span class="token operator">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;success&quot;</span><span class="token operator">:</span> <span class="token boolean">true</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><blockquote><p><code>success</code>是<code>true</code>时，表示验证通过，否则，<code>success</code>是<code>false</code>, <code>msg</code>是错误信息</p></blockquote> <h4 id="_1-3-2-组装交易的txdata"><a href="#_1-3-2-组装交易的txdata" aria-hidden="true" class="header-anchor">#</a> 1.3.2) 组装交易的txData</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 交易创建者的地址</span>
String sender <span class="token operator">=</span> <span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span> senderBytes <span class="token operator">=</span> AddressTool<span class="token punctuation">.</span><span class="token function">getAddress</span><span class="token punctuation">(</span>sender<span class="token punctuation">)</span><span class="token punctuation">;</span>
DeleteContractData deleteContractData <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteContractData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
deleteContractData<span class="token punctuation">.</span><span class="token function">setContractAddress</span><span class="token punctuation">(</span>contractAddressBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>
deleteContractData<span class="token punctuation">.</span><span class="token function">setSender</span><span class="token punctuation">(</span>senderBytes<span class="token punctuation">)</span><span class="token punctuation">;</span>

</code></pre></div><h4 id="_1-3-3-调用接口获取交易创建者的nonce值"><a href="#_1-3-3-调用接口获取交易创建者的nonce值" aria-hidden="true" class="header-anchor">#</a> 1.3.3) 调用接口获取交易创建者的nonce值</h4> <ul><li><p>接口: getAccountBalance</p></li> <li><p>参数: chainId, assetChainId, assetId, address</p> <p>chainId: int //链id</p> <p>assetChainId: int //资产对应的链id</p> <p>assetId  : int //资产id</p> <p>address : String //账户地址</p></li></ul> <p>eg.</p> <p><em><strong>Request:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span><span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;method&quot;</span><span class="token operator">:</span><span class="token string">&quot;getAccountBalance&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;params&quot;</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">&quot;tNULSeBaMvEtDfvZuukDf2mVyfGo3DdiN8KLRG&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token property">&quot;id&quot;</span><span class="token operator">:</span><span class="token number">1234</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>Response:</strong></em></p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
     <span class="token property">&quot;jsonrpc&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2.0&quot;</span><span class="token punctuation">,</span>
     <span class="token property">&quot;id&quot;</span><span class="token operator">:</span> <span class="token number">1234</span><span class="token punctuation">,</span>
     <span class="token property">&quot;result&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
          <span class="token property">&quot;totalBalance&quot;</span><span class="token operator">:</span> <span class="token number">991002297558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;balance&quot;</span><span class="token operator">:</span> <span class="token number">988700097558150</span><span class="token punctuation">,</span>
          <span class="token property">&quot;timeLock&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;consensusLock&quot;</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
          <span class="token property">&quot;freeze&quot;</span><span class="token operator">:</span> <span class="token number">2302200000000</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonce&quot;</span><span class="token operator">:</span> <span class="token string">&quot;a34b2183d44a110a&quot;</span><span class="token punctuation">,</span>
          <span class="token property">&quot;nonceType&quot;</span><span class="token operator">:</span> <span class="token number">1</span>
     <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p><em><strong>需要的数据:</strong></em></p> <div class="language-java extra-class"><pre class="language-java"><code>BigInteger senderBalance <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigInteger</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String nonce <span class="token operator">=</span> result<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;nonce&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="_1-3-4-通过以上3步获取的数据，组装发布合约的交易对象"><a href="#_1-3-4-通过以上3步获取的数据，组装发布合约的交易对象" aria-hidden="true" class="header-anchor">#</a> 1.3.4) 通过以上3步获取的数据，组装发布合约的交易对象</h4> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> DeleteContractTransaction <span class="token function">newDeleteTx</span><span class="token punctuation">(</span><span class="token keyword">int</span> chainId<span class="token punctuation">,</span> <span class="token keyword">int</span> assetsId<span class="token punctuation">,</span> BigInteger senderBalance<span class="token punctuation">,</span> String nonce<span class="token punctuation">,</span> DeleteContractData deleteContractData<span class="token punctuation">,</span> String remark<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
        DeleteContractTransaction tx <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">DeleteContractTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>StringUtils<span class="token punctuation">.</span><span class="token function">isNotBlank</span><span class="token punctuation">(</span>remark<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            tx<span class="token punctuation">.</span><span class="token function">setRemark</span><span class="token punctuation">(</span>remark<span class="token punctuation">.</span><span class="token function">getBytes</span><span class="token punctuation">(</span>StandardCharsets<span class="token punctuation">.</span>UTF_8<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        tx<span class="token punctuation">.</span><span class="token function">setTime</span><span class="token punctuation">(</span>System<span class="token punctuation">.</span><span class="token function">currentTimeMillis</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// 计算CoinData</span>
        CoinData coinData <span class="token operator">=</span> <span class="token function">makeCoinData</span><span class="token punctuation">(</span>chainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> senderBalance<span class="token punctuation">,</span> nonce<span class="token punctuation">,</span> deleteContractData<span class="token punctuation">,</span> tx<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">calcSize</span><span class="token punctuation">(</span>deleteContractData<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setTxDataObj</span><span class="token punctuation">(</span>deleteContractData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">setCoinDataObj</span><span class="token punctuation">(</span>coinData<span class="token punctuation">)</span><span class="token punctuation">;</span>
        tx<span class="token punctuation">.</span><span class="token function">serializeData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> tx<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">IOException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        Log<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeException</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span><span class="token function">getMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h4 id="_1-3-5-签名交易、广播交易（略）"><a href="#_1-3-5-签名交易、广播交易（略）" aria-hidden="true" class="header-anchor">#</a> 1.3.5) 签名交易、广播交易（略）</h4> <h2 id="_2-javascript"><a href="#_2-javascript" aria-hidden="true" class="header-anchor">#</a> 2. JavaScript</h2> <blockquote><p>本语言里，我们已经开发了JS-SDK，内部已经实现离线组装智能合约交易</p></blockquote> <p><strong>GitHub地址:</strong> <a href="https://github.com/nuls-io/nuls-v2-js-sdk" target="_blank" rel="noopener noreferrer">NULS-v2-JS-SDK<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p> <h3 id="_2-1-创建合约"><a href="#_2-1-创建合约" aria-hidden="true" class="header-anchor">#</a> 2.1 创建合约</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCreate.js#L77</code></p> <p><em><strong>核心代码片段:</strong></em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createContract</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> createAddress<span class="token punctuation">,</span> assetsChainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">//1、通过接口获取合约的参数 args</span>
  <span class="token keyword">let</span> hex <span class="token operator">=</span> <span class="token string">'504b03040a0000080000aa7b564e00000000000000000000000003000400696f2ffeca0000504b03040a0000080000aa7b564e00000000000000000000000008000000696f2f6e756c732f504b03040a0000080000aa7b564e00000000000000000000000011000000696f2f6e756c732f636f6e74726163742f504b03040a0000080000aa7b564e00000000000000000000000017000000696f2f6e756c732f636f6e74726163742f746f6b656e2f504b0304140008080800aa7b564e00000000000000000000000028000000696f2f6e756c732f636f6e74726163742f746f6b656e2f53696d706c65546f6b656e2e636c617373b558f97754e5197eeecc90990c972d9090059209a498cc9291a58a8152020d35ca5602b1605bbd99b9492ecc12670922b46ead4babd56aeb5ad1565bd4aa2c020169d59ed353cfe93fd17f84d3d3e7fdee9d3b37612639d5d31ff2ddf77ecbfb3eeff67c77f2afff7cf639804df87b23a23825c323329c96e14c1831fcb411cdf859108f86119497281e93e171997e22cce149197e1ec62ff0d462acc2d3413c13c672fc2a8ce7f0bcccfc3a8817827831cc53bf91e125195e96e5df8af4bb205e09a3430e44f19a0cafcbf086a87d5386df87f096cc9c9597b7457a27843fc8f38f21bc2b7ade0be24f41fc39887341bcaf219033b2a686a6bdc78d692399317213c99152c1ca4d6cd3d0503c951dcb673484d266caca1a99a2066d58c3e252be646446ca535399531a5aeca359a33499dc654d0ce74ae68459e0f1d098417d2993a796d97bca252b93dc674c71b171c49ac819a57281c68766af6edf6be593b972a6984ce573a582912a258be913c9c174ba60168bdb6a9bdb419d412393c99f34d31a4a5f43e337342f0056f5f6d58a6360773e6d4a10ac9cb9bf9c1d330b878db18c8a7a3e6564468d8225efce64a0346931643db7c228e54f98b9e488959de26691a9bbed503957b2b2e6a855b4787c3097636e4a563e47151b6a7b62b87b92a39679924afcbd7d4c6b6b05fdada96cd86ee5acd20e0d3b7a6f75b0decc5c35c37da31a968822cbc80c66f304ae61dd6cfc078d02ebb164166639125dd09143e64365ab60a6a5b2541548e16938dcbb4032e75dad1b8e45f99339b3a0a173fef3acc8e294994bcb565d1d19ac14e8a269235336a5796655c0a9a94a152c192919a9132c47f56eb302b5d048ae386e16f614f2590d47be917bb5bdeb3bc6121c57ea7da53cc3e974f181710d772c60af6ec0828e129242c5030d772e84be2ebea0313555c84f53dd722b972a9846d11c543306c92a6ca4d3667ad48eef7232d79cf565c5f29832e66e0ae53315510ebb49fabf84973d1032ec2d1babe2260f2ed77eb868565f96550e559739b3ab12d7af19cc5109a6bdc583c0d5ba283569a64e90657aeb9f4fd659ab7fa24115ffc68a40df63f3eaf0528b9cf7678b131a06ff27bbb5358547f2e542cadc6349cb2df7306bbf6cd7d18fa48edb65d8884d3a36638b8e217ca0e3436cd1b0a27a6fdc6d1427d9ac3abe8d3b74dc25c35f64f347f858c727381fc4051d177149c7a7b84c42abc3edca76cf61a74586a64da1c82573def5e11ca96477c62816cda2e0213d5cd17115333aaee13a0fccbacf782dd58a888e49983a72c8e83821c367b8a1c382b910ba4a2755d0cd7ad79116adf7e05e1d79301e7fc5df747c8ef31a3a8673c5f2f8b895b2b82fe274703aa254cbe6691d5fe0bc8ea36087270e4f9a11551d916cb9588a8c999109f6312f864869d2c845f2850819dfc8f078e4f67e394e289db32c389413c98fdb36fac5c52f79e32c7cafb216aae57260ecb899a2f6b535fb6bb7f3a261cd7c5153772c0b2e706ce8d001be1c1edacf712a7f527a6bb82e6f86b2e54cc9529f59fdf55ab0ded9d69a78f749eb34149d5b29c22b7f812bcc3f55a6735bbdf7be1d916db7cef4dd3aa5a1bda68123ac4e524ec0cc5a54df5587bd544dd93d3f6172df861a306a1a0d16ec0f025ae83d26e71b53f9ec9451607ee761337e04f9c9868c7b85097943f71eabc51de8e637750c3ec49140039a842af8e3a049d8423d49187cfa8433d493c400d2b492b7f2ef2ecffb003fd699616ca3bc9d3349be697c2e8a5e8676416df90ec70635b9163b38eaf6067c173bf91c745677f1a911422d45beb98ad62fa8682376d750e4ff688ea2be05156dc6f76a280acc45945c50d110f6388afecd1d8bf834a3335476090d571088de40f0e80c4257d05815c3d1d81568d1f815f8a2cd812bf0471397b0b8397015fa552c915397d1780d4b05d0752cf3e3be1b587e54736666b0e21a9a2eba40fbb158fd060c30658bb11a2d6865296cc606a639c6246f645a0799d6434c729a491687b6d8401d8744ea57711049cac5a7a4ef739f5f491b95febb29b705b86d58797eeb4892e50189c51754212692441c8e5dc74a1fbec4aafd89af1064602e24e2ce54f340a02df015429c1449c21f505e75f2f72a887529313611650bc3bd8ec9bf8d798b33e4552f92ae1749ecc53e276dfb29f978ba1b07e8bf9f6797e0204f04f00327a1f6da56ae1de2cc52f86ea22588919b680ee2f0ac248bdf4b7c737c3d825127ef670823c0674f34c6142566d0128d715c1d8d736c95d4c54492ac05aa85daa2c0df8b46825e46b0cd84bc8e80c4b1a8adcf75ac07f7398ef5e087ca31910eaaf408b895fe9ae9e0bde5a4e3491e914cf6c4fe8960e01c02fe6b68932aaba4a6795fdc4ecdbeb8e4c0ef817884d11a453b2174d2f83aea1488115b9f07a21dfb7684713f81f9545417c31fdaa9dd446bad90063517e98ff0632798166d8ae6ae2863199728c6e24e143921f29c3836a9583d80101e64120d92d1980760970bb04b454e53d24105b0665a7fe22279d041d21e750cb7df404705c49ad92096aa9d134ce624bbcff200687701b4ab9ad494340f80075c00136c0151d15d01b0b602404d5c45671d1c59e2c8d1cdbc0747b78ba3dbc5d14d1febe2305c1c978943623c142586ae8aedfdf1c45544ce62859a60e53040e7a057b0b6cc83d5efe9f022a35c22ee32ab6d9a55f4302faf47d8e7a73d8d30e4621f72b10f31cd5b5487df89946a04a9b746e9e21e165ba896533ef914a42c4e3de1907584f545740381685b40bc4bc8108bb705e85d375daaf2acdd0d8fb2d01ea3d5c7b1923abad85955268ab83823187770469846bb61234ec3865821f72826f2c907af83e78c83a7d38327d1b46e06eb2b687a66a1b1cbfe296a7b1a2bf00ccbfe590f924e1749a78ba4d345d2e922697191582e927f7045740cd8b1f0f2b74dd66dce453610508b6dce1dd51688276c49507a59fc39ea7b5efe958836bc40067991fcfc126fa2973d88075cc4032ee20117f1808378156fb5e3e4f32a8bdb335b3923f90f816493248bf3147f42381e9de6aa448ba1bc8a6fed8fc69b36cce0b68a7b8db10423de5d85ee4df72b64ac577975bcc680bf4ee86f78ca72bd0b793d5b6e9ff30563b776031372bf82ec931f340e90a203a4cb01928837f54a862b207ae682b0b3fc16d59d65cdbdcd78bee301e025b7ec1c726b60ac2b00f8b3c701708c6f12cfd5bc075648d3b285dfacde0817dde60cab6def320aef29832df631d7e06a654653415f045fd34e4dd979c8b133e5dc371dd19804597843cabab62ddbc973d4f33eed7e407afcd0435c1daecd0e14944d918aee1543eb2d8ef59263dd74acb7d6f0327e0d7d73ddfc98ee7ce231d9ea9a6c75dc14a9acbe8be6383ced96984f79b1a68ec38959666d8f2f52d12542f894fe5cf6a4758d6b7e8debf11ac7639104887fb6ef2755c53c8c5f2ae53e2c278b3e4b36ece0f35534fe17504b0708ec308779cb09000028180000504b0304140008080800aa7b564e00000000000000000000000022000000696f2f6e756c732f636f6e74726163742f746f6b656e2f546f6b656e2e636c617373a552d14e1341143d03b5cb16aa28a8a0284a08697970131ff481a76a24694282a19507dfa6bb431d989da933b325fc9a0f7e801f65bc534ba5b6a5896eb23b3be79e7bcebd33f7c7cf6fdf01bcc64e84e711b623bc60a8367a3d6bfa5c7de80bed19569a5a0bfb5e71e7848bf092186dcbb53b1376c828699e0b86f55afde89cf779a2b8ee262d6fa5ee1e306c9e14dacb5c9c4a273b4a34b4369e7b69b463d83b9226d18572496ab4b73cf589cb2e123ee224a7525c9248d95de51da318963291ca9c2b4a5eacd59b0ccb9ea8aa55f47aea8a61e3ba869cfb2fc93bd96d6a2fbac29244dce154582a8ecf18ded4a61b37b2cc0ae70e668aec8c37f3915b6add0b3bd6d5fedcae4ec4d7425a9191e2921f1e26c3db39554d2faafe99eee85ae4d09a9ce1d33ca17fb489f86034e8ae63ae94b90cc7c9d0fe2fb799475d6999c2a6e2502af2a8b4cd85d0af0295616b42d0876832e030acfe19c2e3ceb9486942f76fcbd8fd6be06f278fcd7e99816101e1894b749788695fa15d99d66580b0952958157727b07b589dc0eee301a9dfc0b0466f144cd70784877844ff01ac2efc0647a1c7d81886d6166f864684cdd9b94ff0748aef388d085b83ef33dca135141a7c4ad46e488a10ff02504b070868fe421cca0100005e040000504b0304140008080800aa7b564e00000000000000000000000030000000696f2f6e756c732f636f6e74726163742f746f6b656e2f546f6b656e24417070726f76616c4576656e742e636c6173738d565b6f1b4514fec6bbde75b69bbb49d224b46929e05b6a2ee19a4b73218140d2943835b4406163af926d9cdd74771d90a0129540ea033c801020242e2f252f790089b80824c45390f82ffc03049c995dbb89e3243cf8ccd93367e67cdf7c6746fef39f5f7e03f018ae6988e34213148c7333c1cd248f4da998d63083e735bcc0cd0c66b937abe2450d2770218697f838c7cd7c0c176358e0ee256e5e56b1a822c71075deb64d97e1d49ce564ed72c9cb161cdb778d829ff58a6bd98962d1353d6f9841f5364cbbc853a39b46a96c3274cd5d37368decbae1af6627ad9559db37574c97529511cbb6fc3186cb89a3773d66b6e1f6c93c833ce5140940eb9c659b17cbebcba6bb642c9728d231e7148c52de702dfe1d06657fd5f2189a2736365c87b04f6f9ab6cfa0cfdac47caa64789e49d39983607c67cdb4b34bdc9edbb798389e5d2cdbbeb56ee62dcfa22a970cd758377dd39db06dc7377ccbb169cf546382462d27bb68de285bae59a41d632ba6bf10883190481e2747ccab659f39e694f98969b479ae2aa0e6edf9e065f381a03d54f6104979b930eb64e2706114a2639488f97d6152c9b057b20bcbd7cd823f9cbccac01c2ed28129219241a234e77ca3b0366f6c08eda8c1a9f4aae1ad06824b89e42c152156e5122533fa88f94ece772d7b85215e852f760ea2b4b39673ca6ec19cb1782f6842cdf33c4d471f967474a15b470f3727d1abe332f22a5e21e9fe7f37a87855c7237854c5151d4fe16986ee7a189365ab244e3bbe6fe5bbe2f28deab88ad7b8799d006606c28b364ae43203e2ae898c37740c6384a1adfef4187a1bea1ff6391d5a3e9059f43a43e7be7312413aa6fea308379aded362c4ab514b9054c60627c330983828cd41b5c2631aaecbaff6cf11f9fd89a9c3a771869ecc38a82b2121c215a78735c2451723e94ea346f37de8a7effbe9ab44a34c633c75172c95de412495d981941adc81fca358758a6c17a2646f50a68b267868818f4e94719aa2a9603d06f000203c5e97098f578e088fd796708efc4e89261f2467bf7d080f93e590b234f2e5d1d44f88fc50c3a088e03ba2a61e248435191248868bc7289b575404977b0c34117d8fd6dc143b74055935d44a889a2e444320523d90f71b0249370622d503f980d67c7808909e104806830d80c8f5406e3704725e2c3a0044ae07f211adf9f810205c335e98ae7cb8d75f9423d1782b95fe1e51793bbd8b965405d134fdee202a6da77f8732cf75dba58ea22143bf0ad4afd0ba45375ec4298b9f679020514cda9b205513e45db4f381627205b12db472ef0fa8f21664699b404882462f01053e818a4fe9e43e23989f13e52ff026be14b40602c0355ab7e89fc6e3824e1143148be009d1a0badac2fe46bf8a2715d6adb0b836cea9d32b1752ff393cc6e9805d734a306be26046da4ef7ad069c78580ac36f55e37210271a5a10efbb07bf43dc9eafe9367d43cdf32da6f0dd1e35a643d89d04fa193c4b5038d84128ede3ec5fbae511824b30c947e84718cbefffa445f49c862caed1b6bc51867ec5892b77a1773457484141a5b5a32df025eeb7073e616e6dbb594147059df58d77674fe30d8540231815760c67c3a746c173f42c35fd07504b0708ea7bbc798f040000e6090000504b0304140008080800aa7b564e00000000000000000000000030000000696f2f6e756c732f636f6e74726163742f746f6b656e2f546f6b656e245472616e736665724576656e742e636c6173738d56df531b5514fe6e76b31bb60be19740015b5aab8624b06ad156c36f84160da5051a0bd5da25d9c296b08bbb1b5e1c1ffa6ff8aebcf0a033923a3ae3f88433fe2ffe078e7aeedd854212c0879c7bf6dc73eef9cef9cebd933ffff9e53700efe189864e4c3441c12417535c4c73db8c8a590d73b8a3e12e177398e7dabc8a4f345cc244029ff235cfc54202f71258e4ea7d2e1ea85852b1cc203ff3dc6d862b79db359c4ad9378aae1378663130fcd29631552a7996efe7186281cb10df35cb158ba12bffdcdc358d6d33d834a6ed8d7927b0362c8fbc9451dbb183718687a9f30fbc60b7e1f18305823be3960840326f3bd6bdcaf6bae5ad98eb65b2b4e7dda2592e989ecdbf23a31c6cda3e43f38a673afe33cb9bddb59c80419f771ccb9b299bbe6fd176b61e4ce06e598eb1c2e58d53c154e3f5a58a13d8db56c1f66dca72dff4cc6d2bb0bc29c7710333b05d87ce4c372ed03cf63196acaf2ab66795e84475c30ae6040d03a9c18b8850fd23e76b17f498f72b4e47af70e6fc704dd0772124b187729d4163c23ff6ba9c3a9b0c854a30cb54ed6b9153d974368cc5f5e75631c80dae3130971353b72588318988e6e5c02c6e2d983b822f1a674abd69fa9b21c9526a709e92502d95323933fa4804ee72e0d9ce0643e7117c717268a593b565b7e215ad399bf3af090687b99b8e3eace8e842b78e1e2e2ea357c74314547c4674fdff0950f148c73b7857c5aa8e5bb8cdd05d0b63ba62974b96c7d0712af26b7ed5c674ace131179f132bd981c01da3b2b203e26689cd2f74e430cad05adb3786de867c47534ded2a84048bc9a6eca73a248cd4a0fef34a6db47d62a4a8eb8d8681483277762ca7c43094aa27a59ea7a841b91affa3c939c7bf3f3573f636aed1d3d8099a47488871aee9018d71bac54a8cd3aad17e1ffae9fb75fa2ad32ad3da997e0996ce1c2096ce1e404a0f1d40fe51445d21d98538c92c790ea109c36881810e1a82ab644d87f118c01b80d0785e26349e3926349e5bc20dd293120986374fc8b7f036490ec7a09587c6d33f21f6c3717e45186f8a7c7ae810e5634861300a1e276f9e4d1175bc42af09eb2d8ab92d4ee80abd8e112b1162ba060d8148b540720d81641a03916a814c50cce419407a2220596a743d10b916c84c4320c322a80e885c0be40ec5dc3d0308e78b27a68b1e9df517f970ea5ea433df232eef670ed192ae229ea1df77884bfb99dfa12c70de0e699a68c9d2af0af55b24f7a065859dbc783f4307896cd24907e9c8413e441b5fc8265791d843926b7f4095f7204bfb04421265f41250200f150bd4b94582f9804a5ec2975816650d84808fcb7a41ff266e8a724a18215b0cef8be1d4d516f637fa557ca0b06e85756a93bc747adba2d27f8eda381b56d79c1695357130a3ad57fb36c39ab8598acc4f8fec7268a732b4d0def70a7ebbb8398fe826add2f0ac119b8f4fb0311bc1ee20d01fe22382c2c10e41699b64ffd20d8f115c82493a223dc658e1f42705d1531a55f1848ee58332f22b2eadbe84dede5c25064529c9f6d65097b8de16ea8439d9fa4d15ed5574d40eded313833712018d614cc8715c8f9e19051fd393d4f41f504b0708826261e37e040000ca090000504b01020a000a0000080000aa7b564e000000000000000000000000030004000000000000000000000000000000696f2ffeca0000504b01020a000a0000080000aa7b564e000000000000000000000000080000000000000000000000000025000000696f2f6e756c732f504b01020a000a0000080000aa7b564e00000000000000000000000011000000000000000000000000004b000000696f2f6e756c732f636f6e74726163742f504b01020a000a0000080000aa7b564e00000000000000000000000017000000000000000000000000007a000000696f2f6e756c732f636f6e74726163742f746f6b656e2f504b01021400140008080800aa7b564eec308779cb090000281800002800000000000000000000000000af000000696f2f6e756c732f636f6e74726163742f746f6b656e2f53696d706c65546f6b656e2e636c617373504b01021400140008080800aa7b564e68fe421cca0100005e0400002200000000000000000000000000d00a0000696f2f6e756c732f636f6e74726163742f746f6b656e2f546f6b656e2e636c617373504b01021400140008080800aa7b564eea7bbc798f040000e60900003000000000000000000000000000ea0c0000696f2f6e756c732f636f6e74726163742f746f6b656e2f546f6b656e24417070726f76616c4576656e742e636c617373504b01021400140008080800aa7b564e826261e37e040000ca0900003000000000000000000000000000d7110000696f2f6e756c732f636f6e74726163742f746f6b656e2f546f6b656e245472616e736665724576656e742e636c617373504b0506000000000800080051020000b31600000000'</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> constructor <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getContractConstructor</span><span class="token punctuation">(</span>hex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> args <span class="token operator">=</span> constructor<span class="token punctuation">.</span>data<span class="token punctuation">.</span>constructor<span class="token punctuation">.</span>args<span class="token punctuation">;</span>
  <span class="token comment">//console.log(args);</span>
  <span class="token comment">//2、给每个参数复制 获取contractCreateTxData</span>
  <span class="token keyword">let</span> newArgs <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'waves'</span><span class="token punctuation">,</span> <span class="token string">'waves'</span><span class="token punctuation">,</span> <span class="token number">100000000</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> contractCreateTxData <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">makeCreateData</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> createAddress<span class="token punctuation">,</span> <span class="token string">'test_alias'</span><span class="token punctuation">,</span> hex<span class="token punctuation">,</span> newArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//3、序列化</span>

  <span class="token keyword">const</span> balanceInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNulsBalance</span><span class="token punctuation">(</span>createAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> amount <span class="token operator">=</span> contractCreateTxData<span class="token punctuation">.</span>gasLimit <span class="token operator">*</span> contractCreateTxData<span class="token punctuation">.</span>price<span class="token punctuation">;</span>
  <span class="token keyword">let</span> transferInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    fromAddress<span class="token punctuation">:</span> createAddress<span class="token punctuation">,</span>
    assetsChainId<span class="token punctuation">:</span> assetsChainId<span class="token punctuation">,</span>
    assetsId<span class="token punctuation">:</span> assetsId<span class="token punctuation">,</span>
    amount<span class="token punctuation">:</span> amount<span class="token punctuation">,</span>
    fee<span class="token punctuation">:</span> <span class="token number">100000</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> contractCreateTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> txhex<span class="token punctuation">;</span>
  <span class="token comment">//获取手续费</span>
  <span class="token keyword">let</span> newFee <span class="token operator">=</span> <span class="token function">countFee</span><span class="token punctuation">(</span>tAssemble<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//手续费大于0.001的时候重新组装交易及签名</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>transferInfo<span class="token punctuation">.</span>fee <span class="token operator">!==</span> newFee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transferInfo<span class="token punctuation">.</span>fee <span class="token operator">=</span> newFee<span class="token punctuation">;</span>
    inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">15</span><span class="token punctuation">,</span> contractCreateTxData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//4、验证交易</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">//5、广播交易</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">broadcastTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>results <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;交易完成&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;广播交易失败&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证交易失败&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre></div><h3 id="_2-2-调用合约"><a href="#_2-2-调用合约" aria-hidden="true" class="header-anchor">#</a> 2.2 调用合约</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractCall.js#L67</code></p> <p><em><strong>核心代码片段:</strong></em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">callContract</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> fromAddress<span class="token punctuation">,</span> assetsChainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> contractCall<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> balanceInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNulsBalance</span><span class="token punctuation">(</span>fromAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newTimes <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>gasLimit<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> amount <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>newTimes<span class="token punctuation">.</span><span class="token function">times</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>price<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> value <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> newValue <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">BigNumber</span><span class="token punctuation">(</span>contractCall<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token punctuation">;</span>
  amount <span class="token operator">=</span> <span class="token function">Number</span><span class="token punctuation">(</span>newValue<span class="token punctuation">.</span><span class="token function">plus</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> transferInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    fromAddress<span class="token punctuation">:</span> fromAddress<span class="token punctuation">,</span>
    assetsChainId<span class="token punctuation">:</span> assetsChainId<span class="token punctuation">,</span>
    assetsId<span class="token punctuation">:</span> assetsId<span class="token punctuation">,</span>
    amount<span class="token punctuation">:</span> amount<span class="token punctuation">,</span>
    fee<span class="token punctuation">:</span> <span class="token number">100000</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>value <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transferInfo<span class="token punctuation">.</span>toAddress <span class="token operator">=</span> contractCall<span class="token punctuation">.</span>contractAddress<span class="token punctuation">;</span>
    transferInfo<span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> contractCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> txhex<span class="token punctuation">;</span>
  <span class="token comment">//获取手续费</span>
  <span class="token keyword">let</span> newFee <span class="token operator">=</span> <span class="token function">countFee</span><span class="token punctuation">(</span>tAssemble<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token comment">//手续费大于0.001的时候重新组装交易及签名</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>transferInfo<span class="token punctuation">.</span>fee <span class="token operator">!==</span> newFee<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    transferInfo<span class="token punctuation">.</span>fee <span class="token operator">=</span> newFee<span class="token punctuation">;</span>
    inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">16</span><span class="token punctuation">,</span> contractCall<span class="token punctuation">)</span><span class="token punctuation">;</span>
    txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>success<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">broadcastTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>results <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;交易完成&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;广播交易失败&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证交易失败&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> contractCall <span class="token operator">=</span> <span class="token punctuation">{</span>
  chainId<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  sender<span class="token punctuation">:</span> fromAddress<span class="token punctuation">,</span>
  contractAddress<span class="token punctuation">:</span> <span class="token string">&quot;tNULSeBaN1NjSD1qF6Mj6z5XiGLSxaX8fQtg2G&quot;</span><span class="token punctuation">,</span>
  value<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span><span class="token comment">//</span>
  gasLimit<span class="token punctuation">:</span> <span class="token number">20000</span><span class="token punctuation">,</span>
  price<span class="token punctuation">:</span> <span class="token number">25</span><span class="token punctuation">,</span>
  methodName<span class="token punctuation">:</span> <span class="token string">&quot;approve&quot;</span><span class="token punctuation">,</span>
  methodDesc<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  args<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token string">'tNULSeBaNA1fArRNjbHrDi3ZTdQiM26harbwnD'</span><span class="token punctuation">,</span> <span class="token number">88</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><h3 id="_2-3-删除合约"><a href="#_2-3-删除合约" aria-hidden="true" class="header-anchor">#</a> 2.3 删除合约</h3> <p>请参考<code>https://github.com/nuls-io/nuls-v2-js-sdk/blob/master/src/test/contractDelete.js#L33</code></p> <p><em><strong>核心代码片段:</strong></em></p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">deleteContract</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> fromAddress<span class="token punctuation">,</span> assetsChainId<span class="token punctuation">,</span> assetsId<span class="token punctuation">,</span> contractDelete<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> balanceInfo <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">getNulsBalance</span><span class="token punctuation">(</span>fromAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> amount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> transferInfo <span class="token operator">=</span> <span class="token punctuation">{</span>
    fromAddress<span class="token punctuation">:</span> fromAddress<span class="token punctuation">,</span>
    assetsChainId<span class="token punctuation">:</span> assetsChainId<span class="token punctuation">,</span>
    assetsId<span class="token punctuation">:</span> assetsId<span class="token punctuation">,</span>
    amount<span class="token punctuation">:</span> amount<span class="token punctuation">,</span>
    fee<span class="token punctuation">:</span> <span class="token number">100000</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>

  <span class="token keyword">let</span> deleteValidateResult <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateContractDelete</span><span class="token punctuation">(</span>assetsChainId<span class="token punctuation">,</span> contractDelete<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> contractDelete<span class="token punctuation">.</span>contractAddress<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deleteValidateResult<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证删除合约失败&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">let</span> inOrOutputs <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">inputsOrOutputs</span><span class="token punctuation">(</span>transferInfo<span class="token punctuation">,</span> balanceInfo<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> tAssemble <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionAssemble</span><span class="token punctuation">(</span>inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>inputs<span class="token punctuation">,</span> inOrOutputs<span class="token punctuation">.</span>data<span class="token punctuation">.</span>outputs<span class="token punctuation">,</span> remark<span class="token punctuation">,</span> <span class="token number">17</span><span class="token punctuation">,</span> contractDelete<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> txhex <span class="token operator">=</span> <span class="token keyword">await</span> nuls<span class="token punctuation">.</span><span class="token function">transactionSerialize</span><span class="token punctuation">(</span>pri<span class="token punctuation">,</span> pub<span class="token punctuation">,</span> tAssemble<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">validateTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">broadcastTx</span><span class="token punctuation">(</span>txhex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>results <span class="token operator">&amp;&amp;</span> results<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;交易完成&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;广播交易失败&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;验证交易失败&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">let</span> contractDelete <span class="token operator">=</span> <span class="token punctuation">{</span>
  chainId<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
  sender<span class="token punctuation">:</span> fromAddress<span class="token punctuation">,</span>
  contractAddress<span class="token punctuation">:</span> <span class="token string">&quot;tNULSeBaNA1fArRNjbHrDi3ZTdQiM26harbwnD&quot;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/tree/dev/edit/dev/docs/zh/Docs/s_offline_assembly.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2019-9-4 13:46:10</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/zh/Docs/s_nrc721.html" class="prev">
          NRC-721非同质资产标准
        </a></span> <span class="next"><a href="/zh/Docs/s_advance.html">
          高级说明
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.ff9a8a4d.js" defer></script><script src="/assets/js/60.071e1c19.js" defer></script>
  </body>
</html>
