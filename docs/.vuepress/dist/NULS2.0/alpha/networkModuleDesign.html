<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Network module design document | NULS</title>
    <meta name="description" content="NULS">
    <link rel="icon" href="/icon.png">
    
    <link rel="preload" href="/assets/css/0.styles.3751d6d5.css" as="style"><link rel="preload" href="/assets/js/app.af924067.js" as="script"><link rel="preload" href="/assets/js/17.6d7dfbaa.js" as="script"><link rel="prefetch" href="/assets/js/10.18c68eac.js"><link rel="prefetch" href="/assets/js/100.1e5950e6.js"><link rel="prefetch" href="/assets/js/101.ec61cc3b.js"><link rel="prefetch" href="/assets/js/102.714f460f.js"><link rel="prefetch" href="/assets/js/103.bfb17485.js"><link rel="prefetch" href="/assets/js/104.31ed652e.js"><link rel="prefetch" href="/assets/js/105.b2a65d63.js"><link rel="prefetch" href="/assets/js/106.0fb9c136.js"><link rel="prefetch" href="/assets/js/107.654c0826.js"><link rel="prefetch" href="/assets/js/108.6cdf40cd.js"><link rel="prefetch" href="/assets/js/109.d523e3ed.js"><link rel="prefetch" href="/assets/js/11.ed9f9081.js"><link rel="prefetch" href="/assets/js/110.e3dd23c8.js"><link rel="prefetch" href="/assets/js/111.c1eb63c7.js"><link rel="prefetch" href="/assets/js/112.c2e7535c.js"><link rel="prefetch" href="/assets/js/113.01d531d0.js"><link rel="prefetch" href="/assets/js/114.f48cbd1b.js"><link rel="prefetch" href="/assets/js/115.d24ea321.js"><link rel="prefetch" href="/assets/js/116.7cf1209b.js"><link rel="prefetch" href="/assets/js/117.c7a5a31d.js"><link rel="prefetch" href="/assets/js/118.d313dcce.js"><link rel="prefetch" href="/assets/js/119.866797f2.js"><link rel="prefetch" href="/assets/js/12.9499b048.js"><link rel="prefetch" href="/assets/js/120.8aeaf5c5.js"><link rel="prefetch" href="/assets/js/121.ab20734b.js"><link rel="prefetch" href="/assets/js/122.76115daf.js"><link rel="prefetch" href="/assets/js/123.f4fecdaa.js"><link rel="prefetch" href="/assets/js/124.afcd0111.js"><link rel="prefetch" href="/assets/js/125.c0dd25bc.js"><link rel="prefetch" href="/assets/js/126.dc049b64.js"><link rel="prefetch" href="/assets/js/127.9b20344b.js"><link rel="prefetch" href="/assets/js/128.b1676c11.js"><link rel="prefetch" href="/assets/js/129.cf7ff088.js"><link rel="prefetch" href="/assets/js/13.1b5b41f2.js"><link rel="prefetch" href="/assets/js/130.4c55216a.js"><link rel="prefetch" href="/assets/js/131.17a1610f.js"><link rel="prefetch" href="/assets/js/132.6d35b277.js"><link rel="prefetch" href="/assets/js/133.5c6ace8f.js"><link rel="prefetch" href="/assets/js/134.adc3aec7.js"><link rel="prefetch" href="/assets/js/135.9570ffcd.js"><link rel="prefetch" href="/assets/js/136.94f34467.js"><link rel="prefetch" href="/assets/js/137.08e7f039.js"><link rel="prefetch" href="/assets/js/138.abf7e9bd.js"><link rel="prefetch" href="/assets/js/139.89f24e66.js"><link rel="prefetch" href="/assets/js/14.a117362f.js"><link rel="prefetch" href="/assets/js/140.e6f8b514.js"><link rel="prefetch" href="/assets/js/141.e7387218.js"><link rel="prefetch" href="/assets/js/142.537b916c.js"><link rel="prefetch" href="/assets/js/143.aa57a142.js"><link rel="prefetch" href="/assets/js/144.e81588f3.js"><link rel="prefetch" href="/assets/js/145.c006214e.js"><link rel="prefetch" href="/assets/js/146.bf0bce38.js"><link rel="prefetch" href="/assets/js/147.bf8fb102.js"><link rel="prefetch" href="/assets/js/148.9247b58a.js"><link rel="prefetch" href="/assets/js/149.5108d9df.js"><link rel="prefetch" href="/assets/js/15.4d0137e4.js"><link rel="prefetch" href="/assets/js/150.7a9143ed.js"><link rel="prefetch" href="/assets/js/151.20ec1df8.js"><link rel="prefetch" href="/assets/js/152.557985e9.js"><link rel="prefetch" href="/assets/js/153.b677d994.js"><link rel="prefetch" href="/assets/js/154.8eae3dba.js"><link rel="prefetch" href="/assets/js/155.1e5ee1b8.js"><link rel="prefetch" href="/assets/js/156.343285d0.js"><link rel="prefetch" href="/assets/js/157.734685d0.js"><link rel="prefetch" href="/assets/js/158.a5e004d1.js"><link rel="prefetch" href="/assets/js/159.e756229c.js"><link rel="prefetch" href="/assets/js/16.7b01515a.js"><link rel="prefetch" href="/assets/js/160.a082e6bf.js"><link rel="prefetch" href="/assets/js/161.e1fbbb2b.js"><link rel="prefetch" href="/assets/js/162.cd2ec2fe.js"><link rel="prefetch" href="/assets/js/163.401cb3a4.js"><link rel="prefetch" href="/assets/js/164.83fdaeb3.js"><link rel="prefetch" href="/assets/js/165.28ff5f6d.js"><link rel="prefetch" href="/assets/js/166.1d7b2d49.js"><link rel="prefetch" href="/assets/js/167.fc638da4.js"><link rel="prefetch" href="/assets/js/168.87a752b8.js"><link rel="prefetch" href="/assets/js/169.57479665.js"><link rel="prefetch" href="/assets/js/170.328e6d76.js"><link rel="prefetch" href="/assets/js/171.915b4faa.js"><link rel="prefetch" href="/assets/js/172.47c0ddca.js"><link rel="prefetch" href="/assets/js/173.9d44f26b.js"><link rel="prefetch" href="/assets/js/174.5e41dedf.js"><link rel="prefetch" href="/assets/js/175.c45dc2e2.js"><link rel="prefetch" href="/assets/js/176.603141f4.js"><link rel="prefetch" href="/assets/js/177.63dcc5fb.js"><link rel="prefetch" href="/assets/js/178.b56dbf8c.js"><link rel="prefetch" href="/assets/js/179.83dd1a4c.js"><link rel="prefetch" href="/assets/js/18.6031714a.js"><link rel="prefetch" href="/assets/js/180.7b9f2434.js"><link rel="prefetch" href="/assets/js/181.831ae393.js"><link rel="prefetch" href="/assets/js/182.4db1a16d.js"><link rel="prefetch" href="/assets/js/183.a9ddc7d8.js"><link rel="prefetch" href="/assets/js/184.6c3dded5.js"><link rel="prefetch" href="/assets/js/185.b9b8c0b3.js"><link rel="prefetch" href="/assets/js/186.ea0e6453.js"><link rel="prefetch" href="/assets/js/187.ddd07849.js"><link rel="prefetch" href="/assets/js/188.4cf99e7b.js"><link rel="prefetch" href="/assets/js/189.9831d9b2.js"><link rel="prefetch" href="/assets/js/19.99059c8a.js"><link rel="prefetch" href="/assets/js/190.07bb4583.js"><link rel="prefetch" href="/assets/js/191.a980569d.js"><link rel="prefetch" href="/assets/js/192.e63ed356.js"><link rel="prefetch" href="/assets/js/193.c834f9c4.js"><link rel="prefetch" href="/assets/js/194.01ba5cc8.js"><link rel="prefetch" href="/assets/js/195.1cbb062a.js"><link rel="prefetch" href="/assets/js/196.3bd7a397.js"><link rel="prefetch" href="/assets/js/197.b0387864.js"><link rel="prefetch" href="/assets/js/198.341aabcb.js"><link rel="prefetch" href="/assets/js/199.5f7f3387.js"><link rel="prefetch" href="/assets/js/2.cc7febb1.js"><link rel="prefetch" href="/assets/js/20.a2f32098.js"><link rel="prefetch" href="/assets/js/200.0fe4c036.js"><link rel="prefetch" href="/assets/js/201.9cdce6ff.js"><link rel="prefetch" href="/assets/js/202.ff78470d.js"><link rel="prefetch" href="/assets/js/203.8dff672b.js"><link rel="prefetch" href="/assets/js/21.3a5a3d61.js"><link rel="prefetch" href="/assets/js/22.8886c7e3.js"><link rel="prefetch" href="/assets/js/23.824c724b.js"><link rel="prefetch" href="/assets/js/24.373cf0ba.js"><link rel="prefetch" href="/assets/js/25.e03b3fbe.js"><link rel="prefetch" href="/assets/js/26.458fc308.js"><link rel="prefetch" href="/assets/js/27.0715db11.js"><link rel="prefetch" href="/assets/js/28.19752a9c.js"><link rel="prefetch" href="/assets/js/29.908b3be4.js"><link rel="prefetch" href="/assets/js/3.bc2745a1.js"><link rel="prefetch" href="/assets/js/30.d6be6574.js"><link rel="prefetch" href="/assets/js/31.aa92f18e.js"><link rel="prefetch" href="/assets/js/32.ed28a1f1.js"><link rel="prefetch" href="/assets/js/33.1424b6d8.js"><link rel="prefetch" href="/assets/js/34.74e27ef0.js"><link rel="prefetch" href="/assets/js/35.933bcfde.js"><link rel="prefetch" href="/assets/js/36.b04f0887.js"><link rel="prefetch" href="/assets/js/37.dd9a8a5e.js"><link rel="prefetch" href="/assets/js/38.7182d3fd.js"><link rel="prefetch" href="/assets/js/39.1f23ab03.js"><link rel="prefetch" href="/assets/js/4.fe278ee2.js"><link rel="prefetch" href="/assets/js/40.e6429110.js"><link rel="prefetch" href="/assets/js/41.e28d2400.js"><link rel="prefetch" href="/assets/js/42.d71f9399.js"><link rel="prefetch" href="/assets/js/43.91552865.js"><link rel="prefetch" href="/assets/js/44.9a6a71a6.js"><link rel="prefetch" href="/assets/js/45.21a21f6e.js"><link rel="prefetch" href="/assets/js/46.672c63e6.js"><link rel="prefetch" href="/assets/js/47.d3762a03.js"><link rel="prefetch" href="/assets/js/48.c7ee1d97.js"><link rel="prefetch" href="/assets/js/49.04450f16.js"><link rel="prefetch" href="/assets/js/5.36a1f97d.js"><link rel="prefetch" href="/assets/js/50.c88b0ec6.js"><link rel="prefetch" href="/assets/js/51.7b4f991e.js"><link rel="prefetch" href="/assets/js/52.51acdd5e.js"><link rel="prefetch" href="/assets/js/53.ec7916b8.js"><link rel="prefetch" href="/assets/js/54.9e943562.js"><link rel="prefetch" href="/assets/js/55.f67e89c8.js"><link rel="prefetch" href="/assets/js/56.f3264cce.js"><link rel="prefetch" href="/assets/js/57.b4f23a6f.js"><link rel="prefetch" href="/assets/js/58.a34cc362.js"><link rel="prefetch" href="/assets/js/59.81750628.js"><link rel="prefetch" href="/assets/js/6.f0257001.js"><link rel="prefetch" href="/assets/js/60.154b8932.js"><link rel="prefetch" href="/assets/js/61.9b1602a8.js"><link rel="prefetch" href="/assets/js/62.0a49a22d.js"><link rel="prefetch" href="/assets/js/63.98a55a76.js"><link rel="prefetch" href="/assets/js/64.2bcb51d2.js"><link rel="prefetch" href="/assets/js/65.4c0c58c8.js"><link rel="prefetch" href="/assets/js/66.df33b008.js"><link rel="prefetch" href="/assets/js/67.57a2a1be.js"><link rel="prefetch" href="/assets/js/68.bad5e573.js"><link rel="prefetch" href="/assets/js/69.60347b44.js"><link rel="prefetch" href="/assets/js/7.d76f7444.js"><link rel="prefetch" href="/assets/js/70.311b44b8.js"><link rel="prefetch" href="/assets/js/71.83e0120a.js"><link rel="prefetch" href="/assets/js/72.92fc707e.js"><link rel="prefetch" href="/assets/js/73.ddcdaf4e.js"><link rel="prefetch" href="/assets/js/74.e61314d1.js"><link rel="prefetch" href="/assets/js/75.f403a927.js"><link rel="prefetch" href="/assets/js/76.63048a8a.js"><link rel="prefetch" href="/assets/js/77.b09595be.js"><link rel="prefetch" href="/assets/js/78.82b3c1f2.js"><link rel="prefetch" href="/assets/js/79.76b99451.js"><link rel="prefetch" href="/assets/js/8.e9e90edf.js"><link rel="prefetch" href="/assets/js/80.1a5aa1c9.js"><link rel="prefetch" href="/assets/js/81.fd3c1cbb.js"><link rel="prefetch" href="/assets/js/82.a4cf52f9.js"><link rel="prefetch" href="/assets/js/83.f420fc1c.js"><link rel="prefetch" href="/assets/js/84.056c02c1.js"><link rel="prefetch" href="/assets/js/85.2514c295.js"><link rel="prefetch" href="/assets/js/86.b81bc23a.js"><link rel="prefetch" href="/assets/js/87.376a6e56.js"><link rel="prefetch" href="/assets/js/88.5bf2af81.js"><link rel="prefetch" href="/assets/js/89.101bb8fc.js"><link rel="prefetch" href="/assets/js/9.32517bc9.js"><link rel="prefetch" href="/assets/js/90.7631902f.js"><link rel="prefetch" href="/assets/js/91.ac2783b8.js"><link rel="prefetch" href="/assets/js/92.deb816b2.js"><link rel="prefetch" href="/assets/js/93.bab670dd.js"><link rel="prefetch" href="/assets/js/94.49bc0751.js"><link rel="prefetch" href="/assets/js/95.63256329.js"><link rel="prefetch" href="/assets/js/96.1dadeb3c.js"><link rel="prefetch" href="/assets/js/97.377e1c92.js"><link rel="prefetch" href="/assets/js/98.ca3606eb.js"><link rel="prefetch" href="/assets/js/99.9a060e48.js">
    <link rel="stylesheet" href="/assets/css/0.styles.3751d6d5.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NULS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/learn/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/NULS1.0/" class="nav-link">NULS1.0</a></div><div class="nav-item"><a href="/NULS2.0/" class="nav-link router-link-active">NULS2.0</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NULS2.0/alpha/networkModuleDesign.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/learn/" class="nav-link">Guide</a></div><div class="nav-item"><a href="/NULS1.0/" class="nav-link">NULS1.0</a></div><div class="nav-item"><a href="/NULS2.0/" class="nav-link router-link-active">NULS2.0</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/NULS2.0/alpha/networkModuleDesign.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Alpha</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/NULS2.0/quickStart.html" class="sidebar-link">Quick Start</a></li><li><a href="/NULS2.0/packageGeneration.html" class="sidebar-link">Package Generation</a></li><li><a href="/NULS2.0/developModule.html" class="sidebar-link">Develop Business Modules</a></li><li><a href="/NULS2.0/linuxTutorial.html" class="sidebar-link">Linux CLI Manual</a></li><li><a href="/NULS2.0/howToUseNulsBuildChain.html" class="sidebar-link">Build Chain</a></li></ul></div></li><li><div class="sidebar-group"><p class="sidebar-heading"><span>Smart Contract</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/NULS2.0/startSmartContract.html" class="sidebar-link">Quick Start</a></li><li><a href="/NULS2.0/developerManual.html" class="sidebar-link">Development Manual</a></li><li><a href="/NULS2.0/ideaPlugin.html" class="sidebar-link">IDEA Plugin</a></li><li><a href="/NULS2.0/NRC-20TokenStandard.html" class="sidebar-link">NRC-20 Token Standard</a></li><li><a href="/NULS2.0/smartContractFee.html" class="sidebar-link">Service Charge</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="network-module-design-document"><a href="#network-module-design-document" aria-hidden="true" class="header-anchor">#</a> Network module design document</h1> <p>[TOC]</p> <h2 id="_1、general-description"><a href="#_1、general-description" aria-hidden="true" class="header-anchor">#</a> 1、General description</h2> <h3 id="_1-1-module-overview"><a href="#_1-1-module-overview" aria-hidden="true" class="header-anchor">#</a> 1.1 Module overview</h3> <h4 id="_1-1-1-why-have-a-network-module"><a href="#_1-1-1-why-have-a-network-module" aria-hidden="true" class="header-anchor">#</a> 1.1.1 Why  have a Network Module</h4> <p>The network module guarantees the communication between the decentralized nodes and
provides the lowest level of network communication and node discovery services for one of the NULS basic modules. The network foundation of the blockchain is Peer to Peer, or P2P. All participants in the P2P network can be either a server or a client. Features of P2P networks: decentralization, scalability, robustness, cost-effectiveness, privacy protection, and load balancing.</p> <h4 id="_1-1-2-what-to-do-with-network-module"><a href="#_1-1-2-what-to-do-with-network-module" aria-hidden="true" class="header-anchor">#</a> 1.1.2 What to do with Network Module</h4> <p>The network module is the basic module of the entire system, which is used to manage the connection between nodes, nodes and connections, and the transmission and reception of data. Network modules do not involve complex business logic.</p> <ul><li>The received network message is pushed in the corresponding processing module according to the instruction service mapping relationship in the kernel module.</li> <li>The open interface is used to push the message encapsulation of other modules to the specified peer node and broadcast to the specified network group.</li></ul> <h4 id="_1-1-3-the-positioning-of-network-module-in-the-system"><a href="#_1-1-3-the-positioning-of-network-module-in-the-system" aria-hidden="true" class="header-anchor">#</a> 1.1.3  The positioning of &quot;Network Module&quot; in the system</h4> <ul><li>The network module is the underlying application module. Any module that needs network communication must send and receive messages through the network module.</li> <li>Network modules rely on kernelmodules for service interface governance。</li> <li>The network module builds different networks by network id (magic parameter).</li> <li>When the nodes of the network module in the satellite chain are configured for cross-chain networking, a chain management module is required to provide cross-chain configuration information.</li> <li>The nodes of the network module in the sub-chain need to provide cross-chain configuration information when the cross-chain network is built.</li></ul> <h3 id="_1-2-architecture-diagram"><a href="#_1-2-architecture-diagram" aria-hidden="true" class="header-anchor">#</a> 1.2 Architecture diagram</h3> <p><img src="/assets/img/network-context.8f5dc235.png" alt></p> <h2 id="_2、function-design"><a href="#_2、function-design" aria-hidden="true" class="header-anchor">#</a> 2、function design</h2> <h3 id="_2-1-functional-architecture-diagram"><a href="#_2-1-functional-architecture-diagram" aria-hidden="true" class="header-anchor">#</a> 2.1 Functional architecture diagram</h3> <p>​    The network module has  functions in the business: node management, node group management, p2p  network connection management, and message transmission and management.</p> <p>​    The  internal infrastructure functions include: state management of the  module (including startup and shutdown management), and management of  external interfaces.   Thread task management, data storage management, etc.  。</p> <p><img src="/assets/img/network-functions.51710572.png" alt></p> <ul><li><p>Peer Nodes Management</p> <p>Manage all connectable, connected node information, status, and provide node operation interfaces</p> <ul><li>Node discovery</li> <li>Node storage</li></ul></li> <li><p>Node Groups Management</p> <p>Manage different network nodes, divide nodes into different collections, and manage each collection separately. The magic parameters of the nodes connected in each set are the same and are different from the magic parameters of other sets.</p> <p>Each NodeGroup is  initialized according to the information registered in the chain or the  network information configured by itself (magic parameters, number of  nodes, etc.) .Every time a NodeGroup is initialized, the network service listens for more than one MagicNumber.</p></li> <li><p>Connection Management</p> <ul><li>Initialize the connection
<ul><li>Satellite chain node: random connection</li> <li>Cross-chain nodes: fixed algorithm connections, the goal is to spread and cross-link nodes across the chain</li></ul></li> <li>Connection Management: Heartbeat Maintenance</li> <li>Disconnect</li></ul></li> <li><p>Message Management</p> <ul><li>Message receiver</li></ul> <p>Receiving the message sent by the network node, making a simple judgment on the message
(judging command), and sending the message to the module service of interest
according to the message cmd field.</p> <p>[^ps]: RPC API Service interface information (url) is periodically obtained and cached from the kernel module.</p> <ul><li><p>Message receiver</p> <ul><li>NodeGroup broadcast message</li> <li>Send a message to a node</li></ul></li></ul></li></ul> <p>​</p> <ul><li><p>Module Management</p> <ul><li>Start, turn off logic processing</li> <li>Maintenance and management of the status of its own module: management module operation status, internal function status, etc.</li></ul></li> <li><p>RPC Api Management</p> <ul><li><p>Register your own interface into the kernel module</p></li> <li><p>Synchronize module information and status to the kernel module</p></li> <li><p>Get the list of RPC services to the local module</p></li> <li><p>Open external interface call</p></li></ul></li> <li><p>Thread task management</p> <ul><li><p>heartbeat thread</p></li> <li><p>Node discovery/elimination mechanism thread</p></li> <li><p>Interface information synchronization thread</p></li></ul></li></ul> <h3 id="_2-2-module-service"><a href="#_2-2-module-service" aria-hidden="true" class="header-anchor">#</a> 2.2 Module service</h3> <h4 id="_2-2-1-network-message-recieve"><a href="#_2-2-1-network-message-recieve" aria-hidden="true" class="header-anchor">#</a> 2.2.1 Network message recieve</h4> <ul><li><p>Function Description：</p> <p>Receiving the message sent by the (external) network node, making a simple judgment on
the message (determining the magic parameter), and sending the message to the module service of interest according to the command field contained in the message header.</p></li> <li><p>Process description</p> <p><img src="/assets/img/recMessage2.74b8d584.png" alt></p></li> <li><p>Message verification ：</p></li></ul> <p>​        payload validate ：First 4 bytes of  sha256(sha256(payload))</p> <p>​        magicNumbe ：Determine if the nodegroups collection contains the magicNumber</p> <ul><li><p>External module network message receiving interface constraint</p> <ul><li><p>method : ***  //Same as the CMD instruction in the message header, constraining 12 bytes</p> <p>Interface description: The network module transparently forwards the message to the external module.</p></li> <li><p>params</p></li></ul></li></ul> <div class="language- extra-class"><pre class="language-text"><code>    0：chainId  
    1：nodeId  
    2：messageBody
    ......
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>
</code></pre></div><ul><li><p>Dependent service</p> <p>Parsing the command parameter in the message header, relying on the remote service interface data provided by the kernel module when calling the remote interface processing.</p></li></ul> <h4 id="_2-2-2-network-messaging"><a href="#_2-2-2-network-messaging" aria-hidden="true" class="header-anchor">#</a> 2.2.2 Network messaging</h4> <p>Forwards messages encapsulated by other or own modules, including broadcast messages and designated nodes to send messages.</p> <h5 id="_2-2-2-1、broadcast-network-message"><a href="#_2-2-2-1、broadcast-network-message" aria-hidden="true" class="header-anchor">#</a> 2.2.2.1、Broadcast network message</h5> <p>Function Description：</p> <p>Forwarding messages encapsulated by other or its own modules, and providing  interfaces for forwarding calls to external modules have the following two cases:</p> <p>a&gt; Broadcast a message to a NodeGroup (specify a network).</p> <p>b&gt; Broadcast messages to the NodeGroup (specify a network) and exclude certain nodes.</p> <ul><li>Process description</li></ul> <p><img src="/assets/img/sendMsg1.46198729.png" alt></p> <ul><li><p>Interface definition</p> <ul><li>Interface Description</li></ul> <p>​        method : nw_broadcast</p> <p>​       Other modules can broadcast messages through this interface</p> <ul><li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_broadcast&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234，
        &quot;10.13.25.36:5003,20.30.25.65:8009&quot;,
        &quot;03847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF3&quot;,
        &quot;getBlock&quot;
       
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr> <tr><td>1</td> <td>excludeNodes</td> <td>true</td> <td>String</td> <td style="text-align:center">Exclude nodes, comma separated</td></tr> <tr><td>2</td> <td>message</td> <td>true</td> <td>String</td> <td style="text-align:center">Object hexadecimal character</td></tr> <tr><td>3</td> <td>command</td> <td>true</td> <td>String</td> <td style="text-align:center">message command,12 byte</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li></ul></li> <li><p>Dependent service</p></li></ul> <p>​           nothing</p> <h5 id="_2-2-2-2、the-specified-node-sends-a-network-message"><a href="#_2-2-2-2、the-specified-node-sends-a-network-message" aria-hidden="true" class="header-anchor">#</a> 2.2.2.2、The specified node sends a network message</h5> <p>Function Description：</p> <p>Forwarding messages encapsulated by other or its own modules, you can specify that
certain nodes (which can be 1 node) send messages.</p> <ul><li><p>Process description</p> <p><img src="/assets/img/sendMsg2.e2d2bd96.png" alt></p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>External modules can broadcast messages through this interface</p> <p>method : nw_sendPeersMsg</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_sendPeersMsg&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234，
        &quot;10.13.25.36:5003,20.30.25.65:8009&quot;,
        &quot;03847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF303847ABDFF3&quot;,
        &quot;getBlock&quot;
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr> <tr><td>1</td> <td>nodes</td> <td>true</td> <td>String</td> <td style="text-align:center">Send node, comma split</td></tr> <tr><td>2</td> <td>message</td> <td>true</td> <td>String</td> <td style="text-align:center">Object hexadecimal character</td></tr> <tr><td>3</td> <td>command</td> <td>true</td> <td>String</td> <td style="text-align:center">message command,12 byte</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p></li></ul> <p>​        nothing</p> <h4 id="_2-2-3-create-a-node-group"><a href="#_2-2-3-create-a-node-group" aria-hidden="true" class="header-anchor">#</a> 2.2.3 Create a node group</h4> <p>In addition to  its own satellite network, the satellite chain also has n cross-chain  networks. In addition to its own network, there is also a cross-chain  network.</p> <p>Node groups are used to manage different network information. The network module isolates and maintains different networks through node groups.</p> <p>Node  group type: 1&gt; own network 2&gt; cross-chain network (satellite  chain cross-chain network &amp; friend chain cross-chain network)</p> <p>The network module is a call to receive an external module to create a node group. The basic network configuration information of the cross-chain is mainly obtained through two ways:</p> <p>1&gt; The own configuration file is loaded to create its own network group.</p> <p>2&gt; Cross-chain network:</p> <p>As  a satellite chain node, after the registration is registered by the  chain management module, the system generates a transaction verification  confirmation and then calls to generate a cross-chain network group.</p> <p>As  a friend chain node, when started by the cross-chain protocol module,  the cross-chain protocol module obtains cross-chain configuration  information from the module configuration, and notifies the network  module,The network module triggers a cross-chain connection.</p> <ul><li><p>Process description</p> <p>The actual creation of a NodeGroup also has two kinds of logic:</p> <p>1&gt; Generate your own network group (or data load call) by loading the configuration file.</p> <p>2&gt; Call by external module: Create a network group as confirmed by registering cross-chain transactions.</p></li></ul> <h5 id="_2-2-3-1-create-a-node-group-with-its-own-network"><a href="#_2-2-3-1-create-a-node-group-with-its-own-network" aria-hidden="true" class="header-anchor">#</a> 2.2.3.1  Create a node group with its own network</h5> <ul><li><p>Function Description：</p> <p>​     The own network corresponds to its own chainId, and a magic parameter, through the configuration initialization to create a node group.</p></li> <li><p>Process description</p> <p>Create a node group by loading the configuration file</p></li> <li><p>Interface definition</p></li></ul> <p>​      Created internally, no external interface。</p> <ul><li>Dependent service</li></ul> <p>​        none</p> <h5 id="_2-2-3-2-create-a-cross-chain-node-group"><a href="#_2-2-3-2-create-a-cross-chain-node-group" aria-hidden="true" class="header-anchor">#</a> 2.2.3.2 Create a cross-chain node group</h5> <ul><li><p>Function Description：</p> <p>The cross-chain node group on the satellite chain is triggered by the cross-chain registration of the friend chain in the satellite chain. The friend chain obtains cross-chain configuration information, and the cross-chain status of the own network group is updated by the cross-chain protocol.</p></li> <li><p>Process description</p></li></ul> <p>1&gt; The satellite chain is triggered by the chain management module to trigger the creation of a cross-link node group.</p> <p>2&gt; The friend chain updates the cross-chain status of its own network group through the cross-chain protocol module.</p> <p><img src="/assets/img/createNodeGroup.02a8f18e.png" alt></p> <ul><li><p>interface definition</p> <ul><li><p>Interface Description</p> <p>Receive a call to an external module to create a node group</p> <p>method : nw_createNodeGroup</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_createNodeGroup&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234,
        232342,
        10,
        100,
        20，
        &quot;10.20.30.10:8002,48.25.32.12:8003,52.23.25.32:9003&quot;,
        0
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr> <tr><td>1</td> <td>magicNumber</td> <td>true</td> <td>long</td> <td style="text-align:center">magicNumber</td></tr> <tr><td>2</td> <td>maxOut</td> <td>true</td> <td>int</td> <td style="text-align:center">Maximum active connections</td></tr> <tr><td>3</td> <td>maxIn</td> <td>true</td> <td>int</td> <td style="text-align:center">Maximum number of passive connections</td></tr> <tr><td>4</td> <td>minAvailableCount</td> <td>true</td> <td>int</td> <td style="text-align:center">Minimum number of links in the friend chain</td></tr> <tr><td>5</td> <td>seedIps</td> <td>true</td> <td>String</td> <td style="text-align:center">Seed section group comma segmentation</td></tr> <tr><td>6</td> <td>isMoonNode</td> <td>true</td> <td>int</td> <td style="text-align:center">Whether satellite chain node, default 0</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p></li></ul> <p>Relies on remote service interface data provided by the kernel module.</p> <h5 id="_2-2-3-3-friend-chain-activates-cross-chain-connection"><a href="#_2-2-3-3-friend-chain-activates-cross-chain-connection" aria-hidden="true" class="header-anchor">#</a> 2.2.3.3  Friend chain activates cross-chain connection</h5> <ul><li><p>Function Description：</p> <p>The cross-chain node group on the satellite chain is triggered by the cross-chain registration of the friend chain in the satellite chain. The friend chain obtains cross-chain configuration information, and the cross-chain status of the own network group is updated by the cross-chain protocol.</p></li> <li><p>Process description</p> <p>The friend chain updates the cross-chain status of its own network group through the cross-chain protocol module.</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Receive calls from cross-chain modules, activate friend chain cross-chain</p> <p>method : nw_activeCross</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_activeCross&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234,
        10,
        100,
        &quot;10.20.30.10:8002,48.25.32.12:8003,52.23.25.32:9003&quot;
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">Chain identification</td></tr> <tr><td>1</td> <td>maxOut</td> <td>true</td> <td>int</td> <td style="text-align:center">Maximum active connections</td></tr> <tr><td>2</td> <td>maxIn</td> <td>true</td> <td>int</td> <td style="text-align:center">Maximum number of passive connections</td></tr> <tr><td>3</td> <td>seedIps</td> <td>true</td> <td>String</td> <td style="text-align:center">Seed node, comma segmentation</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p></li></ul> <p>​      Relies on remote service interface data provided by the kernel module.</p> <h4 id="_2-2-4-delete-node-group"><a href="#_2-2-4-delete-node-group" aria-hidden="true" class="header-anchor">#</a> 2.2.4 delete node group</h4> <ul><li><p>Function Description:</p> <p>Receive a call from an external module and unregister the cross-chain node group.</p> <p>As a satellite chain node, the chain management module performs  deregistration, and the system generates a transaction verification  confirmation and then calls it.</p></li> <li><p>Process description</p> <p><img src="/assets/img/deleteNodeGroup.1bb694b1.png" alt></p></li> <li><p>Interface definition</p></li> <li><p>Interface Description</p> <p>Receive calls from external modules, delete node groups</p> <p>method : nw_delNodeGroup</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_delNodeGroup&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li> <li><p>Dependent service</p> <p>Relies on remote service interface data provided by the kernel module.</p></li></ul> <h4 id="_2-2-5-cross-chain-seed-node-provision"><a href="#_2-2-5-cross-chain-seed-node-provision" aria-hidden="true" class="header-anchor">#</a> 2.2.5 Cross-chain seed node provision</h4> <ul><li><p>Function Description：</p> <p>The seed node is a node used to provide peer connection information when the network is initialized. When the chain management module performs chain registration, it needs to
obtain the seed node information on the satellite chain for initializing
the connection.</p></li> <li><p>Process description</p> <p>no</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Obtain satellite chain seed node</p> <p>method : nw_getSeeds</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_getSeeds&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
      seedsIps:&quot;101.132.33.140:8003,116.62.135.185:8003,47.90.243.131:8003&quot; 
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>seedsIps</td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>Relies on remote service interface data provided by the kernel module.</p></li></ul> <h4 id="_2-2-6-add-a-connection-node"><a href="#_2-2-6-add-a-connection-node" aria-hidden="true" class="header-anchor">#</a> 2.2.6 Add a connection node</h4> <ul><li><p>Function Description：</p> <p>Add a peer connection information to a network under the cmd command.</p></li> <li><p>Process description</p> <p>The added node triggers the network connection process。</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Add network peer node</p> <p>method : nw_addNodes</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_addNodes&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234，
        1，
       &quot;10.20.23.02:5006,53.26.65.58:8003&quot;
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr> <tr><td>1</td> <td>isCross</td> <td>true</td> <td>int</td> <td style="text-align:center">0 false 1 true</td></tr> <tr><td>2</td> <td>nodes</td> <td>true</td> <td>String</td> <td style="text-align:center">nodes</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th></tr></thead> <tbody><tr><td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-2-7-delete-connection-node"><a href="#_2-2-7-delete-connection-node" aria-hidden="true" class="header-anchor">#</a> 2.2.7 Delete connection node</h4> <ul><li><p>Function Description：</p> <p>Under the cmd command, the peer connection information is deleted for a network.</p></li> <li><p>Process description</p> <p>Deleting a node triggers the disconnection of the network node。</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Delete network peer nodes</p> <p>method : nw_delNodes</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_addNodes&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234，
       &quot;10.20.23.02:5006,53.26.65.58:8003&quot;
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr> <tr><td>1</td> <td>nodes</td> <td>true</td> <td>String</td> <td style="text-align:center">peer nodes</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th></tr></thead> <tbody><tr><td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-2-8-reconnect-to-the-specified-network"><a href="#_2-2-8-reconnect-to-the-specified-network" aria-hidden="true" class="header-anchor">#</a> 2.2.8 Reconnect to the specified network</h4> <ul><li><p>Function Description：</p> <p>Network reconnection of the specified nodeGroup under the cmd command</p></li> <li><p>Process description</p> <p>After receiving the command, disconnect all the peers under the specified nodeGroup and reconnect to the network.</p></li></ul> <p>​       Refresh the peer connection under nodegroup and restart the network connection.</p> <p>​       If  the peer connection is owned by multiple network services, you only  need to cancel the association. If only the service is used by itself,  you can disconnect.</p> <ul><li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Obtain satellite chain seed node</p> <p>method : nw_reconnect</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_reconnect&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1234
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">链标识</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li></ul></li> <li><p>Dependent service
none</p></li></ul> <h4 id="_2-2-9-get-the-list-of-nodegroup"><a href="#_2-2-9-get-the-list-of-nodegroup" aria-hidden="true" class="header-anchor">#</a> 2.2.9 Get the list of nodeGroup</h4> <ul><li><p>Function Description：</p> <p>Get a list of all networks managed by the node。</p></li> <li><p>Process description</p> <p>none</p></li> <li><p>Interface definition</p> <ul><li><p>Interface Description</p> <p>Get node group information</p> <p>method : nw_getGroups</p></li> <li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_getGroups&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1,
        10
    ]}
</code></pre></div></li> <li><p>Request parameter description</p> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>startPage</td> <td>true</td> <td>int</td> <td style="text-align:center">page of starts</td></tr> <tr><td>1</td> <td>pageSize</td> <td>true</td> <td>int</td> <td style="text-align:center">Number of records per page</td></tr></tbody></table></li> <li><p>Return example</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}
</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
        list:[{
            chainId：1212, 
            magicNumber：324234, 
            totalCount：2323,  
            inCount：22,    
            outCount：33,   
            isActive：1， 
            isCrossChain:1  
            },{}
            ]
    }
}
</code></pre></div></li> <li><p>Return field description</p> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>int</td> <td>chainId</td></tr> <tr><td>magicNumber</td> <td>int</td> <td>magicNumber</td></tr> <tr><td>totalCount</td> <td>int</td> <td>Total number of connections</td></tr> <tr><td>inCount</td> <td>int</td> <td>Passive connection number</td></tr> <tr><td>outCount</td> <td>int</td> <td>ctive connections</td></tr> <tr><td>isActive</td> <td>int</td> <td>0 is not activated, 1 is activated</td></tr> <tr><td>isCrossChain</td> <td>int</td> <td>0 is not a cross-chain network, 1 cross-chain network</td></tr></tbody></table></li></ul></li> <li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-2-10-get-the-connection-under-the-nodegroup"><a href="#_2-2-10-get-the-connection-under-the-nodegroup" aria-hidden="true" class="header-anchor">#</a> 2.2.10 Get the connection under the nodeGroup</h4> <ul><li><p>Function Description：</p> <p>Get information about all nodes under the specified network id</p></li> <li><p>Process description</p> <p>none</p></li> <li><p>Interface definition</p> <ul><li>Interface Description</li></ul> <p>​      Get node information</p> <p>​        method : nw_getNodes</p> <ul><li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_reconnect&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        1598,
        0,
        1,
        50
    ]
}

</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr> <tr><td>1</td> <td>state</td> <td>true</td> <td>int</td> <td style="text-align:center">0 all connected, 1 working connected</td></tr> <tr><td>2</td> <td>startPage</td> <td>true</td> <td>int</td> <td style="text-align:center">page of starts</td></tr> <tr><td>3</td> <td>pageSize</td> <td>true</td> <td>int</td> <td style="text-align:center">Number of records per page</td></tr></tbody></table> <ul><li>Return example</li></ul> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}



</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code> {
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
       list:[{
                chainId：122,
                nodeId:&quot;20.20.30.10:9902&quot;
                magicNumber：134124,
                version：2,
                blockHeight：6000,   //区块高度
                blockHash：&quot;0020ba3f3f637ef53d025d3a8972462c00e84d9
                     ea1a960f207778150ffb9f2c173ff&quot;,  //区块Hash值
                ip：&quot;200.25.36.41&quot;,
                port：54, 
                state：&quot;已连接&quot;,
                isOut：&quot;1&quot;, 
                time：&quot;6449878789&quot;, 
	     },{}
	     ]
    }
}

</code></pre></div><ul><li>Return field description</li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>int</td> <td>chainId</td></tr> <tr><td>nodeId</td> <td>String</td> <td>nodeId</td></tr> <tr><td>magicNumber</td> <td>int</td> <td>magicNumber</td></tr> <tr><td>version</td> <td>int</td> <td>protocol version</td></tr> <tr><td>blockHeight</td> <td>long</td> <td>latest block height</td></tr> <tr><td>blockHash</td> <td>String</td> <td>latest block hash</td></tr> <tr><td>ip</td> <td>String</td> <td>peer Ip address</td></tr> <tr><td>port</td> <td>int</td> <td>Server port</td></tr> <tr><td>state</td> <td>String</td> <td>connect state</td></tr> <tr><td>isOut</td> <td>int</td> <td>0 passive connection, 1 active connection</td></tr> <tr><td>time</td> <td>long</td> <td>Recent connection time</td></tr></tbody></table></li> <li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-2-11-get-the-specified-chain-network-profile-information"><a href="#_2-2-11-get-the-specified-chain-network-profile-information" aria-hidden="true" class="header-anchor">#</a> 2.2.11 Get the specified chain network profile information</h4> <ul><li><p>Function Description：</p> <p>Gets the network information of the specified chainId.</p></li> <li><p>Process description</p> <p>none</p></li> <li><p>Interface definition</p> <ul><li>Interface Description</li></ul> <p>​      Gets the network information of the specified chainId.</p> <p>​        method : nw_getNodes</p> <ul><li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_getGroupByChainId&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
        103
    ]}
</code></pre></div><ul><li>Request parameter description</li></ul></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">chainId</td></tr></tbody></table> <ul><li>Return example</li></ul> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}

</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
    &quot;code&quot;:0,
    &quot;result&quot;:{
     
            chainId：1212, 
            magicNumber：324234,
            totalCount：2323, 
            inCount：22,  
            outCount：33, 
            blockHeight：6000,   
            blockHash：&quot;0020ba3f3f637ef53d025d3a8972462c00e84d9
                     ea1a960f207778150ffb9f2c173ff&quot;, 
            isActive：1，
            isCrossActive:1，
            isMoonNet:0
    }
}

</code></pre></div><ul><li>Return field description</li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td>chainId</td> <td>int</td> <td>chainId</td></tr> <tr><td>magicNumber</td> <td>int</td> <td>magicNumber</td></tr> <tr><td>totalCount</td> <td>int</td> <td>total connect</td></tr> <tr><td>blockHeight</td> <td>long</td> <td>latest block height</td></tr> <tr><td>blockHash</td> <td>String</td> <td>latest block hash</td></tr> <tr><td>isActive</td> <td>int</td> <td>0 is not activated, 1 is activated</td></tr> <tr><td>isCrossActive</td> <td>int</td> <td>0 is not a cross-chain network, 1 cross-chain network</td></tr> <tr><td>outCount</td> <td>int</td> <td>active connection count</td></tr> <tr><td>inCount</td> <td>int</td> <td>passive connection count</td></tr> <tr><td>isMoonNet</td> <td>int</td> <td>0 not moon node，1 moon node</td></tr></tbody></table></li> <li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-2-12-update-the-information-of-the-peer-connection-node"><a href="#_2-2-12-update-the-information-of-the-peer-connection-node" aria-hidden="true" class="header-anchor">#</a> 2.2.12 Update the information of the peer connection node</h4> <ul><li><p>Function Description：</p> <p>The network connection has the height and hash value of the peer node when the
handshake connection is made, and the height and hash value of the subsequent peer connection node are called and updated by the external module (block management module).</p></li> <li><p>Process description</p> <p>1&gt; Wait for  the block management interface after the node starts Initialization, and  then call the block management interface to get the latest block height  and hash value.</p> <p>2&gt; When the handshake is performed, the node related information is placed in the Verion information and sent to the peer.</p> <p>3&gt;  After the connection is established, the block management module will  call the interface to update the latest block height and hash value.</p></li> <li><p>Interface definition</p> <ul><li>Interface Description</li></ul> <p>​      The block management module calls to update the height of the node and the hash value.</p> <p>​        method : nw_updateNodeInfo</p> <ul><li><p>Request example</p> <div class="language- extra-class"><pre class="language-text"><code>{
    &quot;method&quot;:&quot;nw_updateNodeInfo&quot;,
    &quot;minVersion&quot;:1.1,
    &quot;params&quot;:[
       1598,
        &quot;10.20.30.20:8856&quot;,
        10,
        &quot;0020ba3f3f637ef53d025d3a8972462c00e84d9ea1a960f207778150ffb9f2c173ff&quot;
    ]
}
</code></pre></div></li> <li><p>Request parameter description</p></li></ul> <table><thead><tr><th>index</th> <th>parameter</th> <th>required</th> <th>type</th> <th style="text-align:center">description</th></tr></thead> <tbody><tr><td>0</td> <td>chainId</td> <td>true</td> <td>int</td> <td style="text-align:center">网络id</td></tr> <tr><td>1</td> <td>nodeId</td> <td>true</td> <td>String</td> <td style="text-align:center">网络节点id</td></tr> <tr><td>2</td> <td>blockHeight</td> <td>true</td> <td>long</td> <td style="text-align:center">区块高度</td></tr> <tr><td>3</td> <td>blockHash</td> <td>true</td> <td>Sting</td> <td style="text-align:center">区块最新hash</td></tr></tbody></table> <p>​</p> <ul><li><p>返回示例</p> <p>Failed</p> <div class="language- extra-class"><pre class="language-text"><code>{
   &quot;version&quot;: 1.2,
    &quot;code&quot;:1,
    &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
    &quot;result&quot;:{}
}

</code></pre></div><p>Success</p> <div class="language- extra-class"><pre class="language-text"><code>{
 &quot;version&quot;: 1.2,
 &quot;code&quot;:0,
 &quot;msg&quot; :&quot;xxxxxxxxxxxxxxxxxx&quot;,
 &quot;result&quot;:{
   
    }
}


</code></pre></div></li> <li><p>返回字段说明</p></li></ul> <table><thead><tr><th>parameter</th> <th>type</th> <th>description</th></tr></thead> <tbody><tr><td></td> <td></td> <td></td></tr></tbody></table></li> <li><p>Dependent service</p> <p>none</p></li></ul> <h2 id="_2-3-module-internal-function"><a href="#_2-3-module-internal-function" aria-hidden="true" class="header-anchor">#</a> 2.3 Module internal function</h2> <h4 id="_2-3-1module-start"><a href="#_2-3-1module-start" aria-hidden="true" class="header-anchor">#</a> 2.3.1Module start</h4> <ul><li><p>Function Description：</p> <p>When the module is started, the configuration information is initialized, the
registration service is initialized, and the initialization of each internal function management database information is performed.</p></li> <li><p>Process description</p></li></ul> <p>​        <img src="/assets/img/start.1e9dac99.png" alt></p> <p>1&gt; load local configuration data, database node group and node information data loading.</p> <p>2 &gt; When the status of the listening block management module is initialized and the interface is callable, the call obtains the block height and Hash value of the latest local node.</p> <p>3&gt; initialization completes and enters peer node connection.</p> <p>4 &gt; The network module notifies the block management module of the maximum block height and hash value after the connection is stable. The block management module provides interfaces for network module calls.</p> <p>The criteria for the stability of network module start-up connection are: no new handshake connection occurs in X seconds, and no height increase in X seconds. X=10</p> <p>5 &gt; After network stabilization, the network is in a working state, and the business state of each chain is released to other modules in an event manner.</p> <ul><li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-3-2-module-off"><a href="#_2-3-2-module-off" aria-hidden="true" class="header-anchor">#</a> 2.3.2 Module off</h4> <ul><li><p>Function Description：</p> <p>When the module is closed, the connection is closed, the thread management is
closed, the resources are released, and the status is notified to the core interface.。</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/shutdown.c5afd6a1.png" alt></p> <ul><li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-3-3-peer-node-discovery"><a href="#_2-3-3-peer-node-discovery" aria-hidden="true" class="header-anchor">#</a> 2.3.3 Peer node discovery</h4> <ul><li><p>Function Description：</p> <p>After the network module is started, the peer node is managed.</p> <p>The ways for node acquisition are:</p> <p>1&gt; Connect to the seed node and request address acquisition.</p> <p>2&gt; Receive the broadcasted node message.</p> <p>2&gt;  The connection of a cross-chain network, for example, as a connection  between a node and a sub-chain on a satellite chain, or a connection  between a node on a sub-chain and a satellite chain.</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/discoverPeer.bc23a3c9.png" alt></p> <ul><li>Dependent service</li></ul> <p>​          none</p> <h4 id="_2-3-4-connection"><a href="#_2-3-4-connection" aria-hidden="true" class="header-anchor">#</a> 2.3.4  connection</h4> <ul><li><p>Function Description：</p> <p>A node acts as the client, actively connecting to a known peer node, and is also a server, waiting for the peer node to connect.</p> <p>A  connection can work normally, and it needs to send a version protocol  message to each other through a handshake protocol. For the specific  definition of the protocol, see the following.</p> <p>&quot;Protocol - Network Communication Protocol Part&quot;.</p></li> <li><p>Process description</p></li></ul> <p>​      After the TCP connection is complete with the server, the client needs to handshake through the rervice version protocol. Only the connection with successful handshake can forward the service. The state in the connection cannot be transitioned to connected after X minutes, and the connection is actively disconnected.</p> <p><img src="/assets/img/connection.18465077.png" alt></p> <p>PS: In order to meet the  requirements of one process carrying multiple-chain services at the same  time, after a node peer connection is established, multiple NodeGroup  services should be satisfied.</p> <p>That is, the node peer connection and the nodeGroup object are many-to-many, n:n relationships.</p> <ul><li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-3-5heartbeat-detection"><a href="#_2-3-5heartbeat-detection" aria-hidden="true" class="header-anchor">#</a> 2.3.5Heartbeat detection</h4> <ul><li><p>Function Description：</p> <p>Check if the connection is still connected. Maintain the keep-alive by ping-pong message from client and server. Refer to the &quot;Protocol - Network Communication Protocol&quot; section for the definition of the ping-pong protocol involved.</p></li> <li><p>Process description</p></li></ul> <p><img src="/assets/img/pingpong.4acdca1b.png" alt></p> <ul><li>Dependent service</li></ul> <p>​      none</p> <h4 id="_2-3-6-connection-quantity-verification"><a href="#_2-3-6-connection-quantity-verification" aria-hidden="true" class="header-anchor">#</a> 2.3.6 Connection quantity verification</h4> <ul><li><p>Function Description：</p> <p>When a node connection is established, the number of connections is made, and
if the maximum is reached, the connection is actively disconnected.。</p></li> <li><p>Process description</p> <p>​      <img src="/assets/img/connet-validate.a03bf001.png" alt></p> <ul><li>Dependent service</li></ul></li></ul> <p>​      none</p> <h4 id="_2-3-7-node-external-network-ip-storage"><a href="#_2-3-7-node-external-network-ip-storage" aria-hidden="true" class="header-anchor">#</a> 2.3.7 Node external network IP storage</h4> <ul><li>Function Description：</li></ul> <p>​         A node may have multiple  network cards, or it may be in a local area network. Therefore, when  establishing a connection, it does not know its own external network IP  address.</p> <p>The node needs to know its own  external network IP address to broadcast its own address for the  external network peers to connect. In our design, the external network of the node is carried by the version protocol message.</p> <ul><li><p>Process description</p> <p>When the client receives the version message, it can know its own IP address information.</p></li></ul> <p><img src="/assets/img/saveNodeIp.bc667171.png" alt></p> <ul><li>Dependent service</li></ul> <p>​     none</p> <h4 id="_2-3-8-node-external-network-connection-detection"><a href="#_2-3-8-node-external-network-connection-detection" aria-hidden="true" class="header-anchor">#</a> 2.3.8 Node external network connection detection</h4> <ul><li>Function Description：</li></ul> <p>​       When a node establishes a connection, it can broadcast its own external network IP+port to other nodes. However, if a node is in a local area network, the IP address of the external network cannot be directly connected. Therefore,in order to detect whether the external network IP of the node is
available, you can connect to your own server through your own client. If the connection is successful, the IP can be used for broadcasting. If it is unsuccessful, the external network IP of the node cannot be
broadcast to other nodes.</p> <ul><li><p>Process description</p> <p>Self-connection
may succeed or fail. If it is successful, the external network IP is reachable, and it can be broadcasted to other nodes in the network when the connection is established. If it is unreachable, the connection
cannot be established.。</p></li></ul> <p><img src="/assets/img/connectSelf.f95af1ba.png" alt></p> <ul><li><p>Dependent service</p> <p>none</p></li></ul> <h4 id="_2-3-9-peer-node-broadcast"><a href="#_2-3-9-peer-node-broadcast" aria-hidden="true" class="header-anchor">#</a> 2.3.9 Peer node broadcast</h4> <ul><li><p>Function Description：</p> <p>Broadcast
its own nodes to other nodes in the network. In the design, we will
broadcast through the self-connection established above。</p></li> <li><p>Process description</p> <p>Constraint: The address broadcast is not carried out between peers in the cross-chain
network, that is, the nodes in the satellite chain are not broadcast to the sub-chain, and the nodes in the same sub-chain are found not to be broadcast to the satellite chain. The satellite chain and the sub-chain need to establish a connection. The initial peer node can send a getAdrr message to request the connection address.</p></li></ul> <p><img src="/assets/img/connectSelf-recieve.b38cf567.png" alt></p> <ul><li>Dependent service</li></ul> <p>none</p> <h4 id="_2-3-10-request-reply-getaddr-protocol-message"><a href="#_2-3-10-request-reply-getaddr-protocol-message" aria-hidden="true" class="header-anchor">#</a> 2.3.10 Request/reply getaddr protocol message</h4> <ul><li><p>Function Description：</p> <p>Request an address protocol message for more network connections</p></li> <li><p>Process description</p> <p>Request getaddr:</p> <p>1&gt;  When a connection in a nodeGroup does not reach the network service  required threshold minAvailableCount, the address list is requested from  the seed node.</p> <p>2&gt; The cross-chain nodeGroup in  the satellite chain node can directly request the obtained address from  the connected peer node.</p> <p>Reply getaddr:</p> <p>1&gt;peer cross-link connection, node reply address list (IP+cross-chain port)</p> <p>2&gt;peer own network connection, the node will reply to the address list (IP+ own chain port)</p></li> <li><p>Dependent service</p></li></ul> <h4 id="_2-3-11-send-receive-address-logic"><a href="#_2-3-11-send-receive-address-logic" aria-hidden="true" class="header-anchor">#</a> 2.3.11  send/receive address logic</h4> <ul><li><p>Function Description：</p> <p>Send &amp; Receive network protocol addr protocol message processing logic</p></li> <li><p>Process description</p> <p>Send addr：</p></li></ul> <p>​    1&gt; When a new node is accessed, an addr message is broadcast to other peers of the same nodegroup.</p> <p>​    2&gt; When the getaddr message is requested, the addr message will be replied.</p> <p>​     Receive addr:</p> <p>​      1&gt; Determine whether the address is already owned locally. If you do not forward it, get the new addr.</p> <p>​      2&gt;PEER is not cross-chain network forwarding</p> <p>​      3&gt; Own network, add addr&gt;0, store and broadcast forwarding (except receiving peer)</p> <ul><li><p>Dependent service</p> <p>none</p></li></ul> <h2 id="_3、event-description"><a href="#_3、event-description" aria-hidden="true" class="header-anchor">#</a> 3、Event description</h2> <h3 id="_3-1-published-event"><a href="#_3-1-published-event" aria-hidden="true" class="header-anchor">#</a> 3.1 Published event</h3> <p>[^remark]: Here is the topic of the event, the format protocol of the event (accurate to byte), and the occurrence of the event.</p> <h4 id="_3-1-1-nodegroup-reaches-the-lower-limit-of-the-number-of-nodes"><a href="#_3-1-1-nodegroup-reaches-the-lower-limit-of-the-number-of-nodes" aria-hidden="true" class="header-anchor">#</a> 3.1.1 NodeGroup reaches the lower limit of the number of nodes</h4> <p>Description: The NodeGroup reaches the lower limit of the number of nodes and the event is advertised.</p> <pre><code> event_topic : &quot;evt_nw_inNodeLimit&quot;,
</code></pre> <div class="language- extra-class"><pre class="language-text"><code>  data:{
      chainId
      magicNumber
      nodeCount
      nodeLimit
      time
  }
  

</code></pre></div><h4 id="_3-1-2-nodegroup-is-less-than-the-minimum-number-of-nodes"><a href="#_3-1-2-nodegroup-is-less-than-the-minimum-number-of-nodes" aria-hidden="true" class="header-anchor">#</a> 3.1.2 NodeGroup is less than the minimum number of nodes</h4> <p>Description: The NodeGroup is less than the lower limit of the number of nodes. The event is advertised.</p> <pre><code> event_topic : &quot;evt_nw_lessNodeLimit&quot;,
</code></pre> <div class="language- extra-class"><pre class="language-text"><code>  data:{
      chainId
      magicNumber
      nodeCount
      nodeLimit
      time
  }
  

</code></pre></div><h4 id="_3-1-3-node-handshake-succeeded"><a href="#_3-1-3-node-handshake-succeeded" aria-hidden="true" class="header-anchor">#</a> 3.1.3 Node handshake succeeded</h4> <p>Description: The node handshake is successful and the event is advertised.</p> <pre><code> event_topic : &quot;evt_nw_connectSuccess&quot;,
</code></pre> <div class="language- extra-class"><pre class="language-text"><code>  data:{
      chainId
      magicNumber
      nodeId
      time
      version
  }
  

</code></pre></div><h4 id="_3-1-4-node-disconnected"><a href="#_3-1-4-node-disconnected" aria-hidden="true" class="header-anchor">#</a> 3.1.4 Node disconnected</h4> <p>Description: The node is disconnected and the event is published</p> <pre><code> event_topic : &quot;evt_nw_nodeDisconnect&quot;,
</code></pre> <div class="language- extra-class"><pre class="language-text"><code>  data:{
      chainId
      magicNumber
      nodeId
      time
      version
  }
  

</code></pre></div><h3 id="_3-2-subscribed-event"><a href="#_3-2-subscribed-event" aria-hidden="true" class="header-anchor">#</a> 3.2 Subscribed event</h3> <pre><code>​     none
</code></pre> <ul><li></li></ul> <h2 id="_4、protocol"><a href="#_4、protocol" aria-hidden="true" class="header-anchor">#</a> 4、protocol</h2> <h3 id="_4-1-network-communication-protocol"><a href="#_4-1-network-communication-protocol" aria-hidden="true" class="header-anchor">#</a> 4.1 Network communication protocol</h3> <h4 id="version"><a href="#version" aria-hidden="true" class="header-anchor">#</a> version</h4> <p>Used to establish a connection (handshake)</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>version</td> <td>uint32</td> <td>Protocol version identifier used by the node</td></tr> <tr><td>20</td> <td>addr_you</td> <td>byte[20]</td> <td>The peer network address [IP+PORT1+PORT2] PORT2 is a cross-chain server port.                                                                               For example: [10.32.12.25 8003 9003] 16byte+2byte+2byte</td></tr> <tr><td>20</td> <td>addr_me</td> <td>byte[20]</td> <td>The self network address [IP+PORT1+PORT2] PORT2 is a cross-chain server port.                                                                               For example: [20.32.12.25 8003 9003] 16byte+2byte+2byte</td></tr> <tr><td>4</td> <td>block_height</td> <td>uint32</td> <td>node latest block height</td></tr> <tr><td>？</td> <td>block_hash</td> <td>varInt</td> <td>node latest block hash</td></tr> <tr><td>6</td> <td>network_time</td> <td>uint48</td> <td>Network time</td></tr> <tr><td>??</td> <td>extend</td> <td>VarByte</td> <td>extended field, no more than 10 bytes</td></tr></tbody></table> <h4 id="verack"><a href="#verack" aria-hidden="true" class="header-anchor">#</a> verack</h4> <p>Used to answer version</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>1</td> <td>ack_code</td> <td>uint8</td> <td>Return code, 1 means normal, 2 means the connection is full</td></tr></tbody></table> <h4 id="ping"><a href="#ping" aria-hidden="true" class="header-anchor">#</a> ping</h4> <pre><code>Used to maintain the connection. After receiving a message for a certain node for a 
</code></pre> <p>period of time, the message is sent. If the pong message is received, the node remains connected. Otherwise, the connection is closed and the  node is deleted.</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>randomCode</td> <td>uint32</td> <td>random number</td></tr></tbody></table> <h4 id="pong"><a href="#pong" aria-hidden="true" class="header-anchor">#</a> pong</h4> <pre><code>reply for ping
</code></pre> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>4</td> <td>randomCode</td> <td>uint32random number</td> <td></td></tr></tbody></table> <h4 id="getaddr"><a href="#getaddr" aria-hidden="true" class="header-anchor">#</a> getaddr</h4> <p>Used to obtain connection information of available nodes in the network, no message body</p> <h4 id="addr"><a href="#addr" aria-hidden="true" class="header-anchor">#</a> addr</h4> <p>Used to reply getaddr, or announce the existence of itself to the network. After receiving the message, the node determines whether the node is known. If it is an unknown node, it propagates the message to the network.</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>??</td> <td>addr_list</td> <td>network address</td> <td>18 bytes per node (16 bytes IP + 2 bytes port）</td></tr></tbody></table> <h4 id="bye"><a href="#bye" aria-hidden="true" class="header-anchor">#</a> Bye</h4> <p>Used for peer connection to disconnect actively, rejecting service message connection</p> <table><thead><tr><th>Length</th> <th>Fields</th> <th>Type</th> <th>Remark</th></tr></thead> <tbody><tr><td>1</td> <td>byeCode</td> <td>uint8</td> <td>预留字段</td></tr></tbody></table> <h3 id="_4-2-transaction-agreement"><a href="#_4-2-transaction-agreement" aria-hidden="true" class="header-anchor">#</a> 4.2 Transaction agreement</h3> <pre><code>​        none
</code></pre> <h2 id="_5、module-configuration"><a href="#_5、module-configuration" aria-hidden="true" class="header-anchor">#</a> 5、Module configuration</h2> <div class="language- extra-class"><pre class="language-text"><code>  [network]
  network.self.server.port=8003
  network.self.chainId=9861
  network.self.magic=68866996
  network.self.max.in=100
  network.self.max.out=10
  network.self.seed.ip=127.0.0.1:8003
  #Satellite chain configuration information
  network.moon.node=true
  network.moon.server.port=8004
  network.moon.max.in=100
  network.moon.max.out=10
  network.moon.seed.ip=215.159.216.58:8003,215.159.69.140:8003,223.206.200.74:8003
  

</code></pre></div><h2 id="_6、java-specific-design"><a href="#_6、java-specific-design" aria-hidden="true" class="header-anchor">#</a> 6、Java-specific design</h2> <p>[^remark]: Core object class definition, storing data structures，......</p> <h2 id="_7、-to-add-on"><a href="#_7、-to-add-on" aria-hidden="true" class="header-anchor">#</a> 7、 to add on</h2> <p>[^remark]: Required content not covered above</p></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/dev/docs/NULS2.0/alpha/networkModuleDesign.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">3/28/2019, 12:38:23 AM</span></div></div> <!----> </div> <!----></div></div>
    <script src="/assets/js/app.af924067.js" defer></script><script src="/assets/js/17.6d7dfbaa.js" defer></script>
  </body>
</html>
