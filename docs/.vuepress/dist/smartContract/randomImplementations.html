<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Ways of creating random numbers for NULS | NULS</title>
    <meta name="description" content="NULS">
    
    
    <link rel="preload" href="/assets/css/0.styles.e4f4c31f.css" as="style"><link rel="preload" href="/assets/js/app.a22ec7d7.js" as="script"><link rel="preload" href="/assets/js/59.a125ac7f.js" as="script"><link rel="prefetch" href="/assets/js/10.74e2c17d.js"><link rel="prefetch" href="/assets/js/11.4f7fa307.js"><link rel="prefetch" href="/assets/js/12.03d27bd6.js"><link rel="prefetch" href="/assets/js/13.e407f4bb.js"><link rel="prefetch" href="/assets/js/14.29a73e0d.js"><link rel="prefetch" href="/assets/js/15.12980442.js"><link rel="prefetch" href="/assets/js/16.6fb58e9f.js"><link rel="prefetch" href="/assets/js/17.12b0b65c.js"><link rel="prefetch" href="/assets/js/18.ef8a3f7f.js"><link rel="prefetch" href="/assets/js/19.75c38d33.js"><link rel="prefetch" href="/assets/js/20.d78122c0.js"><link rel="prefetch" href="/assets/js/21.32857727.js"><link rel="prefetch" href="/assets/js/22.c21dbed1.js"><link rel="prefetch" href="/assets/js/23.a81bb94d.js"><link rel="prefetch" href="/assets/js/24.02649ec3.js"><link rel="prefetch" href="/assets/js/25.f10130fb.js"><link rel="prefetch" href="/assets/js/26.c0d41e09.js"><link rel="prefetch" href="/assets/js/27.60a0d6a1.js"><link rel="prefetch" href="/assets/js/28.0adb14e7.js"><link rel="prefetch" href="/assets/js/29.9cec7237.js"><link rel="prefetch" href="/assets/js/3.d2acb6a3.js"><link rel="prefetch" href="/assets/js/30.d68bbdb0.js"><link rel="prefetch" href="/assets/js/31.dcf88b81.js"><link rel="prefetch" href="/assets/js/32.cf8542a3.js"><link rel="prefetch" href="/assets/js/33.3fc7a331.js"><link rel="prefetch" href="/assets/js/34.cba6b9c8.js"><link rel="prefetch" href="/assets/js/35.494fa2be.js"><link rel="prefetch" href="/assets/js/36.c3ab37a4.js"><link rel="prefetch" href="/assets/js/37.e0788960.js"><link rel="prefetch" href="/assets/js/38.9a48ef21.js"><link rel="prefetch" href="/assets/js/39.e6668e35.js"><link rel="prefetch" href="/assets/js/4.38f6b44d.js"><link rel="prefetch" href="/assets/js/40.6307c937.js"><link rel="prefetch" href="/assets/js/41.f7a113ed.js"><link rel="prefetch" href="/assets/js/42.34dd4254.js"><link rel="prefetch" href="/assets/js/43.bdabefb4.js"><link rel="prefetch" href="/assets/js/44.a831de78.js"><link rel="prefetch" href="/assets/js/45.b78342c8.js"><link rel="prefetch" href="/assets/js/46.771b0e34.js"><link rel="prefetch" href="/assets/js/47.369e4ef1.js"><link rel="prefetch" href="/assets/js/48.4bb8b947.js"><link rel="prefetch" href="/assets/js/49.48c4fd4a.js"><link rel="prefetch" href="/assets/js/5.1bd5ef5e.js"><link rel="prefetch" href="/assets/js/50.56f075fb.js"><link rel="prefetch" href="/assets/js/51.dae25c4d.js"><link rel="prefetch" href="/assets/js/52.9e4bbc29.js"><link rel="prefetch" href="/assets/js/53.7db30b4d.js"><link rel="prefetch" href="/assets/js/54.15d189c5.js"><link rel="prefetch" href="/assets/js/55.5afc4da7.js"><link rel="prefetch" href="/assets/js/56.62dc5cc0.js"><link rel="prefetch" href="/assets/js/57.3909c900.js"><link rel="prefetch" href="/assets/js/58.431966d2.js"><link rel="prefetch" href="/assets/js/6.af3065c2.js"><link rel="prefetch" href="/assets/js/60.e35ab80a.js"><link rel="prefetch" href="/assets/js/61.bda180cc.js"><link rel="prefetch" href="/assets/js/62.d9fb101c.js"><link rel="prefetch" href="/assets/js/63.296c0190.js"><link rel="prefetch" href="/assets/js/64.5bc15caf.js"><link rel="prefetch" href="/assets/js/65.93ccf818.js"><link rel="prefetch" href="/assets/js/66.48d53328.js"><link rel="prefetch" href="/assets/js/67.fcb548e5.js"><link rel="prefetch" href="/assets/js/68.f03e37a5.js"><link rel="prefetch" href="/assets/js/69.49b218e1.js"><link rel="prefetch" href="/assets/js/7.f2ea7c13.js"><link rel="prefetch" href="/assets/js/70.57c0fd61.js"><link rel="prefetch" href="/assets/js/71.3fb0077a.js"><link rel="prefetch" href="/assets/js/72.78c314bd.js"><link rel="prefetch" href="/assets/js/73.c4e49878.js"><link rel="prefetch" href="/assets/js/74.db283428.js"><link rel="prefetch" href="/assets/js/75.772f3f5f.js"><link rel="prefetch" href="/assets/js/76.7d220a79.js"><link rel="prefetch" href="/assets/js/77.02bebb23.js"><link rel="prefetch" href="/assets/js/78.0fa6a6e6.js"><link rel="prefetch" href="/assets/js/79.b8638d8d.js"><link rel="prefetch" href="/assets/js/8.0c614372.js"><link rel="prefetch" href="/assets/js/80.c5c125e0.js"><link rel="prefetch" href="/assets/js/81.d763c351.js"><link rel="prefetch" href="/assets/js/82.32342395.js"><link rel="prefetch" href="/assets/js/83.91cd2f41.js"><link rel="prefetch" href="/assets/js/84.fe83947a.js"><link rel="prefetch" href="/assets/js/85.952d0dc9.js"><link rel="prefetch" href="/assets/js/86.8908ae63.js"><link rel="prefetch" href="/assets/js/87.4ef79520.js"><link rel="prefetch" href="/assets/js/88.628f6d6d.js"><link rel="prefetch" href="/assets/js/89.f0d1d7cf.js"><link rel="prefetch" href="/assets/js/9.70325410.js"><link rel="prefetch" href="/assets/js/90.9f8cff5b.js"><link rel="prefetch" href="/assets/js/91.12f24a21.js"><link rel="prefetch" href="/assets/js/92.2b594ff6.js"><link rel="prefetch" href="/assets/js/93.fffd120d.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.2192dbe7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4f4c31f.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">NULS</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/smartContract/randomImplementations.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/smartContract/randomImplementations.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/smartContract/randomImplementations.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/zh/smartContract/randomImplementations.html" class="nav-link">简体中文</a></li></ul></div></div> <a href="https://github.com/nuls-io/devsite" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first collapsable"><p class="sidebar-heading"><span>Overview</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Users Guide</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Community</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Launch NULS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Quickly Building A Chain</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Underlying Design Of NULS</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading open"><span>Smart Contracts</span> <span class="arrow down"></span></p> <ul class="sidebar-group-items"><li><a href="/smartContract/startSmartContract.html" class="sidebar-link">Quick Start</a></li><li><a href="/smartContract/developerManual.html" class="sidebar-link">NULS Smart Contract Development Manual</a></li><li><a href="/smartContract/GUIForSmartContract.html" class="sidebar-link">User Document of Wallet Smart Contract</a></li><li><a href="/smartContract/ideaPlugin.html" class="sidebar-link">NULS IDEA Plugin User Manual</a></li><li><a href="/smartContract/NRC-20TokenStandard.html" class="sidebar-link">NRC-20 Token Standard</a></li><li><a href="/smartContract/smartContractFee.html" class="sidebar-link">Service charge for smart contracts</a></li><li><a href="/smartContract/randomImplementations.html" class="active sidebar-link">Ways of creating random numbers for NULS</a><ul class="sidebar-sub-headers"></ul></li></ul></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>Developer Tools</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>NIPs</span> <span class="arrow right"></span></p> <!----></div></li><li><div class="sidebar-group collapsable"><p class="sidebar-heading"><span>NULS Portal</span> <span class="arrow right"></span></p> <!----></div></li></ul> </div> <div class="page"> <div class="content"><h1 id="ways-of-creating-random-numbers-for-nuls"><a href="#ways-of-creating-random-numbers-for-nuls" aria-hidden="true" class="header-anchor">#</a> Ways of creating random numbers for NULS</h1> <blockquote><p>References:</p> <p>[Solidity Pitfalls: Random Number Generation for Ethereum]
(https://www.sitepoint.com/solidity-pitfalls-random-number-generation-for-ethereum/)</p> <p>[Predicting Random Numbers in Ethereum Smart Contracts]
(https://blog.positive.com/predicting-random-numbers-in-ethereum-smart-contracts-e5358c6b8620)</p></blockquote> <h3 id="_1-linear-congruential-generator-lcg-algorithm-to-generate-pseudorandom-numbers"><a href="#_1-linear-congruential-generator-lcg-algorithm-to-generate-pseudorandom-numbers" aria-hidden="true" class="header-anchor">#</a> 1. <code>Linear Congruential Generator (LCG)</code>: algorithm to generate pseudorandom numbers</h3> <p>The NULS smart contract SDK provides a way to create random numbers. It takes the current block's miner address, contract address, contract invoker address, and current block’s timestamp as random factors, and uses the algorithm <code>linear congruential generator (LCG)</code> to generate pseudorandom numbers</p> <p>Invoking like this:</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>io<span class="token punctuation">.</span>nuls<span class="token punctuation">.</span>contract<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span>Utils<span class="token punctuation">.</span><span class="token function">pseudoRandom</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">/**
 * add a random factor
 */</span>
io<span class="token punctuation">.</span>nuls<span class="token punctuation">.</span>contract<span class="token punctuation">.</span>sdk<span class="token punctuation">.</span>Utils<span class="token punctuation">.</span><span class="token function">pseudoRandom</span><span class="token punctuation">(</span><span class="token keyword">long</span> seed<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>--</p> <h3 id="_2-using-the-blockhash-of-the-future-block"><a href="#_2-using-the-blockhash-of-the-future-block" aria-hidden="true" class="header-anchor">#</a> 2. Using the <code>BlockHash</code> of the future block</h3> <p>Taking lottery as an example, it needs to invoke contract transactions twice - close the lottery and pick the winner.</p> <p>Once the lottery is closed, record the current block height H1 and generate a number N. Pick the winner when the height of the future block reaches <code>H1+N</code>。</p> <p>When picking the winner, add up the recorded block height H1 and block number in interval (0~80] (to be determined) to the block height H2, and take the <code>BlockHash</code> of the block H2 as a random seed.</p> <p>ETH cannot use this way for the following reasons:
<img src="https://cdn-images-1.medium.com/max/1600/1*eyNTfWTkmM-3YuMca-1H0A.png" alt></p> <p>--</p> <h3 id="_3-random-seeds-limited-to-participants"><a href="#_3-random-seeds-limited-to-participants" aria-hidden="true" class="header-anchor">#</a> 3. Random seeds limited to participants</h3> <p>In the case of lottery, we need more arbitrary data for picking our winner. When we determine the winner, we can use the addresses of the players that have entered our lottery smart contract as random factors to generate random numbers.</p> <p>--</p> <h3 id="_4-commit-reveal"><a href="#_4-commit-reveal" aria-hidden="true" class="header-anchor">#</a> 4. commit-reveal</h3> <p>Also take the lottery as an example.</p> <ul><li><p>The contract sets aside awards for the random number.</p></li> <li><p>Each user generates own secret random number N.</p></li> <li><p>Users can hash their N and address to generate the hash value of their secret random numbers: String hash = sha3(N + Msg.sender()).</p></li></ul> <p>Note: step 2 and 3 should be performed locally, for instance, the user submits N to the lottery application, which performs the hash operation.</p> <ul><li><p>Users submit their hash to the smart contract.</p></li> <li><p>Submission is open until the number of blocks reaches a certain value, or until enough participants join.</p></li> <li><p>Once the submission is closed, it’s time to pick the winner.</p></li> <li><p>Each user submits their random number N to the smart contract.</p></li> <li><p>The contract verifies sha3 (N + Msg.sender()) to match the original submission.</p></li> <li><p>If the user fails to submit a valid N in time, his deposit will be forfeited.</p></li> <li><p>Perform XOR operation on all-verified N to get random numbers.</p></li> <li><p>These numbers are used to determine the winners --&gt; (N % numUsers).</p></li></ul></div> <div class="page-edit"><div class="edit-link"><a href="https://github.com/nuls-io/devsite/edit/dev/docs/smartContract/randomImplementations.md" target="_blank" rel="noopener noreferrer">Edit this page on GitHub</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">1/11/2019, 1:47:19 PM</span></div></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/smartContract/smartContractFee.html" class="prev">
          Service charge for smart contracts
        </a></span> <span class="next"><a href="/developerTools/sdk.html">
          SDK
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.a22ec7d7.js" defer></script><script src="/assets/js/59.a125ac7f.js" defer></script>
  </body>
</html>
